MODULE PriceListTrip;

REQUIRE PriceList, TripInvoice;

createPriceList 'Создать прайс'(Trip trip) = ACTION NEWSESSION {
    FOR ADDOBJ p = UserPriceList DO {
        FOR in(trip, invoice(InvoiceDetail detail)) ADDOBJ d = UserPriceListDetail DO {
            userPriceList(d) <- p;
            sku(d) <- sku(detail);    
        }
        FORM userPriceList OBJECTS p = p MANAGESESSION DOCKEDMODAL;  
    }    
}

EXTEND FORM trips
    PROPERTIES createPriceList(t) FORCE PANEL TOOLBAR 
;