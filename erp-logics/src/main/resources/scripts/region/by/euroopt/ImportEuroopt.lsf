MODULE ImportEuroopt;

REQUIRE System, Item, ItemDescription, ItemNutrition, ImportUserPriceList, PurchasePack;

CLASS EurooptItemGroup 'Группа товаров';
TABLE eurooptItemGroup (EurooptItemGroup);

url 'URL' = DATA VARSTRING[255] (EurooptItemGroup);
title 'Заголовок' = DATA VARSTRING[100] (EurooptItemGroup);
eurooptItemGroup = GROUP AGGR EurooptItemGroup e BY url(e); 

CLASS EurooptItemList 'Список товаров';
TABLE eurooptItemList (EurooptItemList);

eurooptItemGroup = DATA EurooptItemGroup(EurooptItemList);
url 'URL' = DATA VARSTRING[255] (EurooptItemList);
eurooptItemList = GROUP AGGR EurooptItemList e BY url(e); 

CLASS EurooptItem 'Товар';
TABLE eurooptItem (EurooptItem);

eurooptItemList = DATA EurooptItemList(EurooptItem);
url 'URL' = DATA VARSTRING[255] (EurooptItem);
eurooptItem = GROUP AGGR EurooptItem e BY url(e);


importEurooptAction 'Импортировать' = CUSTOM 'lsfusion.erp.region.by.euroopt.ImportEurooptActionProperty' ();
importEurooptUseTor 'Использовать Tor' = DATA BOOLEAN();
importEurooptSkipKeys 'Не создавать новые товары' = DATA BOOLEAN();
importEurooptItems 'Импортировать товары' = DATA BOOLEAN();
importEurooptOnlyImages 'Только изображения' = DATA BOOLEAN();
importEurooptSmallImages 'Маленькие изображения' = DATA BOOLEAN();
importEurooptUserPriceLists 'Импортировать прайс-листы' = DATA BOOLEAN();

synchronizeItemsImportEurooptAction 'Синхронизировать товары' = CUSTOM 'lsfusion.erp.region.by.euroopt.SynchronizeItemsEurooptActionProperty' ();

idItemGroup 'Код группы товаров' (Barcode barcode) = id(skuGroup(sku(barcode)));

EXTEND FORM integrationData
    PROPERTIES() importEurooptAction, importEurooptUseTor, importEurooptSkipKeys, importEurooptItems, importEurooptOnlyImages,
                 importEurooptSmallImages, importEurooptUserPriceLists, synchronizeItemsImportEurooptAction
    OBJECTS ig = EurooptItemGroup, il = EurooptItemList, i = EurooptItem
    PROPERTIES(ig) READONLY url, title
    PROPERTIES(il) READONLY url
    PROPERTIES(i) READONLY url
    FILTERS eurooptItemGroup(il) == ig, eurooptItemList(i) == il          
;
DESIGN integrationData {
    pane {
        NEW euroopt {
            caption = 'Евроопт';
            MOVE PROPERTY(importEurooptAction());
            MOVE PROPERTY(importEurooptUseTor());
            MOVE PROPERTY(importEurooptSkipKeys());
            MOVE PROPERTY(importEurooptItems());
            MOVE PROPERTY(importEurooptOnlyImages());
            MOVE PROPERTY(importEurooptSmallImages());
            MOVE PROPERTY(importEurooptUserPriceLists());
            MOVE PROPERTY(synchronizeItemsImportEurooptAction());
            MOVE BOX(ig);
            MOVE BOX(il);
            MOVE BOX(i);
        }
    }
}