MODULE SaleShipmentConsignmentBy;

REQUIRE SaleShipment,
        ConsignmentBy;

NAMESPACE Sale;

@defineConsignmentHeader (shipment);

@implementConsignmentHeaderData (Shipment);


dataSupplierConsignment (consignment) += supplierShipment(consignment);
supplierStockConsignment (consignment) += supplierStockShipment(consignment);
customerConsignment (consignment) += customerShipment(consignment);
customerStockConsignment (consignment) += customerStockShipment(consignment);
dataCurrencyConsignment (consignment) += currencyShipment(consignment);

dataShipmentBaseConsignment (consignment) += shipmentBaseOperation(operationShipment(consignment));

EXTEND CLASS ShipmentDetail : ConsignmentDetail;

consignmentConsignmentDetail (detail) += shipmentShipmentDetail (detail);
skuConsignmentDetail (detail) += skuShipmentDetail (detail);
batchConsignmentDetail (detail) += batchShipmentDetail (detail);
quantityConsignmentDetail (detail) += quantityShipmentDetail (detail);

dataPackQuantityConsignmentDetail (detail) += quantityShipmentDetail (detail);
@defineDocumentDetailGrossWeight (shipment, sku);
dataGrossWeightConsignmentDetail (detail) += grossWeightShipmentDetail (detail);

dataPriceConsignmentDetail (detail) += priceShipmentDetail(detail);
dataSumConsignmentDetail (detail) += sumShipmentDetail(detail);
dataSumInvoiceConsignmentDetail (detail) += sumShipmentDetail(detail);

showConsignmentShipment (shipment) = TRUE AND NOT relationInvoiceShipment(shipment);

EXTEND FORM  shipments
    PROPERTIES (s)  FORCE PANEL printConsignmentVerticalA, printConsignmentVerticalAB, printConsignmentHorizontalA,
                     printConsignmentVerticalB, printConsignmentHorizontalB,
                     printConsignmentAttach, printConsignmentSimpleHorizontal, editAttributesConsignment,
                     printConsignmentSimpleVertical, printConsignmentSimpleAttach,
                     printConsignmentVertical, printConsignmentHorizontal, printConsignmentAttachXLS
;

EXTEND DESIGN shipments {
    printTab {
        NEW consignmentRow1 {
            align = LEADING;
            type = CONTAINERH;

            NEW contOne {
                alignment = STRETCH;
                type = CONTAINERH;
                caption = 'Накладная';
                ADD PROPERTY(editAttributesConsignment(s)) {
                    alignment = STRETCH;
                }
            }
            NEW tn2 {
                alignment = STRETCH;
                type = COLUMNS;
                columns = 3;
                caption = 'ТН-2';
                ADD PROPERTY(printConsignmentSimpleVertical(s));
                ADD PROPERTY(printConsignmentSimpleHorizontal(s));
                ADD PROPERTY(printConsignmentSimpleAttach(s));
            }
        }
        NEW consignmentRow2 {
            align = LEADING;
            type = COLUMNS;
            columns = 3;
            caption = 'ТТН-1';
            ADD PROPERTY(printConsignmentVerticalA(s));
            ADD PROPERTY(printConsignmentVerticalAB(s));
            ADD PROPERTY(printConsignmentHorizontalA(s));
            ADD PROPERTY(printConsignmentVerticalB(s));
            ADD PROPERTY(printConsignmentHorizontalB(s));
            ADD PROPERTY(printConsignmentAttach(s));
            ADD PROPERTY(printConsignmentVertical(s));
            ADD PROPERTY(printConsignmentHorizontal(s));
        }
        NEW export {
            type = CONTAINERH;
            caption = 'Экспорт';  
            ADD PROPERTY(printConsignmentAttachXLS(s));
        }
    }
}

