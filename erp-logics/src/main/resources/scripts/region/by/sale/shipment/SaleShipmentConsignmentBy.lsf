MODULE SaleShipmentConsignmentBy;

REQUIRE SaleShipment,
        ConsignmentBy;

NAMESPACE Sale;

@defineConsignmentHeader (shipment);

defaultArrivalTimeShipment 'Время прибытия' (shipment) = currentDateTime() IF shipment IS Shipment; // чтобы сработал метакод
defaultDowntimeShipment 'Время простоя' (shipment) = dataDowntime()IF shipment IS Shipment;  // чтобы сработал метакод

@implementConsignmentHeader (Shipment);   


dataSupplierConsignment (consignment) += supplierShipment(consignment);
supplierStockConsignment (consignment) += supplierStockShipment(consignment);
customerConsignment (consignment) += customerShipment(consignment);
customerStockConsignment (consignment) += customerStockShipment(consignment);
dataCurrencyConsignment (consignment) += currencyShipment(consignment);

dataShipmentBaseConsignment (consignment) += shipmentBaseOperation(operationShipment(consignment));

EXTEND CLASS ShipmentDetail : ConsignmentDetail;

consignmentConsignmentDetail (detail) += shipmentShipmentDetail (detail);
skuConsignmentDetail (detail) += skuShipmentDetail (detail);
quantityConsignmentDetail (detail) += quantityShipmentDetail (detail);

dataPackQuantityConsignmentDetail (detail) += quantityShipmentDetail (detail);
@defineDocumentDetailGrossWeight (shipment, sku);
dataGrossWeightConsignmentDetail (detail) += grossWeightShipmentDetail (detail);

dataPriceConsignmentDetail (detail) += priceShipmentDetail(detail);
dataSumConsignmentDetail (detail) += sumShipmentDetail(detail);
dataSumInvoiceConsignmentDetail (detail) += sumShipmentDetail(detail);

showConsignmentShipment (shipment) = TRUE AND NOT relationInvoiceShipment(shipment);

EXTEND FORM  shipments
    PROPERTIES (s)  FORCE PANEL printConsignmentVerticalA, printConsignmentVerticalAB, printConsignmentHorizontalA,
                     printConsignmentVerticalB, printConsignmentHorizontalB,
                     printConsignmentAttach, printConsignmentSimpleHorizontal, editConsignment,
                     printConsignmentSimpleVertical, printConsignmentSimpleAttach,
                     printConsignmentVertical, printConsignmentHorizontal, printConsignmentAttachXLS
;

EXTEND DESIGN shipments {
    printTab {
        NEW consignmentRow1 {
            align = LEADING;
            type = CONTAINERH;

            NEW contOne {
                alignment = STRETCH;
                type = CONTAINERH;
                caption = 'Накладная';
                ADD PROPERTY(editConsignment) {
                    alignment = STRETCH;
                }
            }
            NEW tn2 {
                alignment = STRETCH;
                type = COLUMNS;
                columns = 3;
                caption = 'ТН-2';
                ADD PROPERTY(printConsignmentSimpleVertical);
                ADD PROPERTY(printConsignmentSimpleHorizontal);
                ADD PROPERTY(printConsignmentSimpleAttach);
            }
        }
        NEW consignmentRow2 {
            align = LEADING;
            type = COLUMNS;
            columns = 3;
            caption = 'ТТН-1';
            ADD PROPERTY(printConsignmentVerticalA);
            ADD PROPERTY(printConsignmentVerticalAB);
            ADD PROPERTY(printConsignmentHorizontalA);
            ADD PROPERTY(printConsignmentVerticalB);
            ADD PROPERTY(printConsignmentHorizontalB);
            ADD PROPERTY(printConsignmentAttach);      
            ADD PROPERTY(printConsignmentVertical);  
            ADD PROPERTY(printConsignmentHorizontal);
        }
        NEW export {
            type = CONTAINERH;
            caption = 'Экспорт';  
            ADD PROPERTY(printConsignmentAttachXLS);                
        }
    }
}

