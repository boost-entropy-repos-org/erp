MODULE SaleShipmentConsignmentBy;

REQUIRE SaleShipment,
        SaleOperationConsignmentBy,
        ConsignmentBy;

NAMESPACE Sale;

@defineConsignmentHeader (shipment);

@implementConsignmentHeaderData (Shipment);


dataSupplierConsignment (consignment) += supplierShipment(consignment);
supplierStockConsignment (consignment) += supplierStockShipment(consignment);
dataCustomerConsignment (consignment) += customerShipment(consignment);
customerStockConsignment (consignment) += customerStockShipment(consignment);
dataCurrencyConsignment (consignment) += currencyShipment(consignment);

consignmentTypeConsignment (consignment) += consignmentTypeOperation(operationShipment(consignment));
dataShipmentBaseConsignment (consignment) += shipmentBaseOperation(operationShipment(consignment));
ownerTrackTypeConsignment (consignment) += ownerTrackTypeOperation(operationShipment(consignment));

notUseDriverTruckConsignment(c) += notUseDriverTruckOperation(operationShipment(c));

notUseIssuanceAllowedConsignment(c) += notUseIssuanceAllowedOperation(operationShipment(c));
notUseIssuanceExecutedConsignment(c) += notUseIssuanceExecutedOperation(operationShipment(c));
useGoodsAcceptedConsignment(c) += useGoodsAcceptedOperation(operationShipment(c));

EXTEND CLASS ShipmentDetail : ConsignmentDetail;

consignmentConsignmentDetail (detail) += shipmentShipmentDetail (detail);
skuConsignmentDetail (detail) += skuShipmentDetail (detail);
indexConsignmentDetail (detail) += indexShipmentDetail (detail);
batchConsignmentDetail (detail) += batchShipmentDetail (detail);
quantityConsignmentDetail (detail) += quantityShipmentDetail (detail);

dataPackQuantityConsignmentDetail (detail) += quantityShipmentDetail (detail);
@defineDocumentDetailGrossWeight (shipment, sku);
dataGrossWeightConsignmentDetail (detail) += grossWeightShipmentDetail (detail);

dataPriceConsignmentDetail (detail) += priceShipmentDetail(detail);
dataSumConsignmentDetail (detail) += sumShipmentDetail(detail);
dataSumInvoiceConsignmentDetail (detail) += sumShipmentDetail(detail);

showConsignmentShipment (shipment) = TRUE AND NOT relationInvoiceShipment(shipment);

EXTEND FORM  shipments
    PROPERTIES (s)  FORCE PANEL printConsignmentVerticalA, printConsignmentVerticalAB, printConsignmentHorizontalA,
                     printConsignmentVerticalB, printConsignmentHorizontalB,
                     printConsignmentAttach, printConsignmentSimpleHorizontal, editAttributesConsignment,
                     printConsignmentSimpleVertical, printConsignmentSimpleAttach,
                     printConsignmentVertical, printConsignmentHorizontal, printConsignmentAttachXLS
;

DESIGN shipments {
    printTab {
        NEW consignmentRow1 {
            align = LEADING;
            type = CONTAINERH;

            NEW contOne {
                alignment = STRETCH;
                type = CONTAINERH;
                caption = 'Накладная';
                MOVE PROPERTY(editAttributesConsignment(s)) {
                    alignment = STRETCH;
                }
            }
            NEW tn2 {
                alignment = STRETCH;
                type = COLUMNS;
                columns = 3;
                caption = 'ТН-2';
                MOVE PROPERTY(printConsignmentSimpleVertical(s));
                MOVE PROPERTY(printConsignmentSimpleHorizontal(s));
                MOVE PROPERTY(printConsignmentSimpleAttach(s));
            }
        }
        NEW consignmentRow2 {
            align = LEADING;
            type = COLUMNS;
            columns = 3;
            caption = 'ТТН-1';
            MOVE PROPERTY(printConsignmentVerticalA(s));
            MOVE PROPERTY(printConsignmentVerticalAB(s));
            MOVE PROPERTY(printConsignmentHorizontalA(s));
            MOVE PROPERTY(printConsignmentVerticalB(s));
            MOVE PROPERTY(printConsignmentHorizontalB(s));
            MOVE PROPERTY(printConsignmentAttach(s));
            MOVE PROPERTY(printConsignmentVertical(s));
            MOVE PROPERTY(printConsignmentHorizontal(s));
        }
        NEW export {
            type = CONTAINERH;
            caption = 'Экспорт';  
            MOVE PROPERTY(printConsignmentAttachXLS(s));
        }
    }
}

