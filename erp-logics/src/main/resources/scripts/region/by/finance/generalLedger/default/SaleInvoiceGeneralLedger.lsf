MODULE SaleInvoiceGeneralLedger;

REQUIRE GeneralLedger, SaleInvoice, DimensionLegalEntity, DimensionStock;

NAMESPACE Sale;

//------------------- Отгрузка по безналу --------------------//

EXTEND CLASS Invoice : GeneralLedger.GLDocument;
nameGLDocument(document) += descriptionInvoice(document);
numberGLDocument(document) += numberInvoice(document);
seriesGLDocument(document) += seriesInvoice(document);
dateTimeGLDocument(document) += dateTimeInvoice(document);
//editGLDocument (GLDocument)+= editInvoice(GLDocument);

////////////////////////////// Отгрузка по безналу (из розницы) //////////////////////////////////
//------------------- Розничная сумма --------------------//
//-- Тара
@defineGeneralLedgerAggregationOperation (invoice,                                 // основание
                                          InvRetC,                                 // идентификатор
                                          supplier,                                // компания
                                          invoiceSumContainerInvoiceDetailInvoice, // сумма
                                          description,                             // описание
                                          '62.1',                                  // дебет
                                          '41.3',                                  // кредит
                                          'by_default',                            // идентификатор плана счетов
                                          'by_default_sale_invoice_retail'         // идентификатор операции
                                          );
debitGeneralLedgerDimensionType(generalLedger,dimensionType) += WHEN CLASS(invoiceInvRetCGeneralLedger(generalLedger)) AND dimensionType == DimensionType.organization THEN customerInvoice(invoiceInvRetCGeneralLedger(generalLedger));
creditGeneralLedgerDimensionType(generalLedger,dimensionType) += WHEN CLASS(invoiceInvRetCGeneralLedger(generalLedger)) AND dimensionType == DimensionType.stock THEN supplierStockInvoice(invoiceInvRetCGeneralLedger(generalLedger));

//-- Товар
@defineGeneralLedgerAggregationOperation (invoice,
                                          InvRetI,
                                          supplier,
                                          invoiceSumItemInvoiceDetailInvoice,
                                          description,
                                          '62.1',
                                          '41.2',
                                          'by_default',
                                          'by_default_sale_invoice_retail'
                                          );
debitGeneralLedgerDimensionType(generalLedger,dimensionType) += WHEN CLASS(invoiceInvRetIGeneralLedger(generalLedger)) AND dimensionType == DimensionType.organization THEN customerInvoice(invoiceInvRetIGeneralLedger(generalLedger));
creditGeneralLedgerDimensionType(generalLedger,dimensionType) += WHEN CLASS(invoiceInvRetIGeneralLedger(generalLedger)) AND dimensionType == DimensionType.stock THEN supplierStockInvoice(invoiceInvRetIGeneralLedger(generalLedger));

// ----------------------------------- Стандартные данные ----------------------------------- //

@defineLoadDefaultOperation (Sale, iname, isid);
loadDefaultOperationsSaleRetailBy 'Загрузить стандарные операции отгрузки товара из магазина' () = ACTION () {
    EXEC loadDefaultOperation ('Отгрузка товара из магазина по безналичному расчету', 'by_default_sale_invoice_retail');
} ;

loadDefaultOperations () += loadDefaultOperationsSaleRetailBy();
