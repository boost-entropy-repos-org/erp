MODULE TopBy;

REQUIRE System, EDI, Integration, Warehouse, Store;

NAMESPACE EDI;

EXTEND CLASS EDIProvider {
    topBy 'СТТ'
}

loginTopBy 'Имя пользователя TopBy' = DATA VARSTRING[100] ();
passwordTopBy 'Пароль TopBy' = DATA VARSTRING[100] () ECHO;
hostTopBy 'Хост' = DATA VARSTRING[100] ();
portTopBy 'Порт' = DATA INTEGER ();
receive 'Получить сообщения' = ACTION CUSTOM 'lsfusion.erp.region.by.integration.edi.topby.ReceiveMessagesActionProperty' ();

EXTEND FORM integrationData
    PROPERTIES() loginTopBy, passwordTopBy, hostTopBy, portTopBy, receive
;
    
DESIGN integrationData {
    pane {
        NEW vs {
            caption = 'TopBy';
            MOVE PROPERTY(loginTopBy());
            MOVE PROPERTY(passwordTopBy());
            MOVE PROPERTY(hostTopBy());
            MOVE PROPERTY(portTopBy());
            MOVE PROPERTY(receive());
        }
    }
}

sendTopBy 'Отправить' = ACTION CUSTOM 'lsfusion.erp.region.by.integration.edi.topby.SendEOrderActionProperty' (EOrder);

send(EOrder o) += ACTION IF EDIProvider(supplier(o)) == EDIProvider.topBy THEN sendTopBy(o);