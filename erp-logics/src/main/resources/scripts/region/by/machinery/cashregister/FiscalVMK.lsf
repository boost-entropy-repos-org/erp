MODULE FiscalVMK;

REQUIRE System,
        POS;


needDLL() = GROUP SUM 1 IF computer(CashRegister c) == currentComputer() AND sidModel(groupMachinery(c)) == 'VMK';
onClientStarted() += {
	IF needDLL() THEN {
	    IF is64Java(currentComputer()) THEN
	        loadLibrary('lib/win64/vmkd.dll');
	    ELSE
	        loadLibrary('lib/win32/vmkd.dll');
	}
};

fiscalVMKPrint 'Напечатать фискальный чек' = CUSTOM 'lsfusion.erp.region.by.machinery.cashregister.fiscalvmk.FiscalVMKPrintReceiptActionProperty' (Receipt);
postPrint(Receipt receipt) += { IF sidCashRegisterModel(receipt) == 'VMK' THEN fiscalVMKPrint(receipt); }

fiscalVMKReceiptTitle 'Заголовок чека VMK' = ABSTRACT TEXT ();
fiscalVMKTop 'Дополнительный текст перед чеком VMK' = ABSTRACT TEXT (Receipt);
fiscalVMKBottom 'Дополнительный текст после чека VMK' = ABSTRACT TEXT (Receipt);

fiscalVMKPrintCopyReceipt 'Копия чека' = CUSTOM 'lsfusion.erp.region.by.machinery.cashregister.fiscalvmk.FiscalVMKPrintCopyReceiptActionProperty' ();
fiscalPrintCopyReceipt() += { IF sidModelCurrentCashRegister() == 'VMK' THEN fiscalVMKPrintCopyReceipt(); }

fiscalVMKAdvancePaper 'Прогон ленты' = CUSTOM 'lsfusion.erp.region.by.machinery.cashregister.fiscalvmk.FiscalVMKAdvancePaperActionProperty' ();
fiscalAdvancePaper() += { IF sidModelCurrentCashRegister() == 'VMK' THEN fiscalVMKAdvancePaper(); }

fiscalVMKXReport 'X-отчёт' = CUSTOM 'lsfusion.erp.region.by.machinery.cashregister.fiscalvmk.FiscalVMKXReportActionProperty' ();
fiscalXReport() += { IF sidModelCurrentCashRegister() == 'VMK' THEN fiscalVMKXReport(); }

fiscalVMKZReport 'Z-отчёт' = CUSTOM 'lsfusion.erp.region.by.machinery.cashregister.fiscalvmk.FiscalVMKZReportActionProperty' ();
fiscalZReport() += { IF sidModelCurrentCashRegister() == 'VMK' THEN fiscalVMKZReport(); }

fiscalVMKCashSum 'Наличных в кассе' = CUSTOM 'lsfusion.erp.region.by.machinery.cashregister.fiscalvmk.FiscalVMKCashSumActionProperty' ();
fiscalCashSum() += { IF sidModelCurrentCashRegister() == 'VMK' THEN fiscalVMKCashSum(); }

fiscalVMKReportTop 'Заголовок отчёта VMK' = ABSTRACT TEXT ();

fiscalVMKUpdateData 'Загрузить информацию' = CUSTOM 'lsfusion.erp.region.by.machinery.cashregister.fiscalvmk.FiscalVMKUpdateDataActionProperty' ();
fiscalUpdateData() += { IF sidModelCurrentCashRegister() == 'VMK' THEN fiscalVMKUpdateData(); }

fiscalVMKService 'Перемещение денег' = CUSTOM 'lsfusion.erp.region.by.machinery.cashregister.fiscalvmk.FiscalVMKServiceInOutActionProperty' (CashOperation);
fiscalService(CashOperation cashOperation) += { IF sidCashRegisterModel(cashOperation) == 'VMK' THEN fiscalVMKService(cashOperation); }

fiscalVMKDisplayText 'Вывести текст на дисплей' = CUSTOM 'lsfusion.erp.region.by.machinery.cashregister.fiscalvmk.FiscalVMKDisplayTextActionProperty' (ReceiptDetail);
fiscalDisplayText (ReceiptDetail receiptDetail) += { IF sidCashRegisterModel(receiptDetail) == 'VMK' THEN fiscalVMKDisplayText(receiptDetail); }

fiscalVMKCancel 'Отменить чек' = CUSTOM 'lsfusion.erp.region.by.machinery.cashregister.fiscalvmk.FiscalVMKCancelReceiptActionProperty' (Receipt);
fiscalCancel(Receipt receipt) += { IF sidModelCurrentCashRegister() == 'VMK' THEN fiscalVMKCancel(receipt); }

UNP 'УНП' = DATA VARSTRING[9] (Machinery);
UNPCurrentCashRegister() = UNP(currentCashRegister());
regNumber 'Регистрационный номер' = DATA VARSTRING[20] (Machinery);
regNumberCurrentCashRegister() = regNumber(currentCashRegister());
machineryNumber 'Номер КСА' = DATA VARSTRING[20] (Machinery);
machineryNumberCurrentCashRegister() = machineryNumber(currentCashRegister());

EXTEND FORM groupCashRegister
    PROPERTIES(c) UNP, regNumber, machineryNumber
;