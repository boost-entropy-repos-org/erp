MODULE WarePurchaseInvoice;

REQUIRE WareInvoice, PurchaseInvoice, PurchaseShipment;

NAMESPACE Purchase;

@defineInvoiceWare(Purchase);

extraShipmentPriceUserInvoiceDetail(detail) += IF itemWareUserInvoiceDetailUserInvoiceDetail(detail) THEN
                                                   -calcShipmentPriceUserInvoiceDetail(detail)
                                               ELSE
                                                   calcShipmentPriceUserInvoiceDetail(wareUserInvoiceDetailUserInvoiceDetail(detail));

CONSTRAINT  isPostedInvoiceDetail(d) AND isItemSku(skuInvoiceDetail(d)) AND NOT (skuInvoiceDetail(d) IS Ware) AND
    dateInvoiceDetail(d) >= dateBanBarcodeStock(customerStockInvoiceDetail(d)) AND NOT idBarcodeSkuInvoiceDetail(d)
        MESSAGE 'Для строки накладной (закупка) обязан быть задан штрихкод';   