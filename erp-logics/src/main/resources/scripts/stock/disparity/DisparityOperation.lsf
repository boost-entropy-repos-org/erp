MODULE DisparityOperation;

REQUIRE Operation, Disparity;

NAMESPACE Disparity;

@defineOperation('(изменение сортности)');
@defineOperationRole();
@extendFormFilterRole(o, dialogOperations);
//@extendFormFilterRole(o, operations);     //-- пока не нужен

DESIGN operation {
    tabContainer{
        NEW createContainer {
            caption = 'Производные документы';
        }
    }
}

NAVIGATOR {
    disparityNavigator {
        ADD operations;
    }
}

//------------------------------------------ Опеределение операции для disparity ------------------------------------//

operationDisparity = DATA Operation (Disparity) PERSISTENT;
nameOperationDisparity 'Операция' = nameOperation(operationDisparity(disparity));

operationDisparityDetail 'Операция' (disparityDetail) = operationDisparity(disparityDisparityDetail(disparityDetail));

EXTEND FORM disparity
    PROPERTIES(dis) nameOperationDisparity
;

DESIGN disparity{
    dis.documentPrm{
        MOVE PROPERTY(nameOperationDisparity(dis)) BEFORE PROPERTY(noteDisparity(dis));
    }
}
EXTEND FORM disparities
    PROPERTIES(dis) READONLY nameOperationDisparity AFTER nameStockDisparity(dis)
;

useDisparityItemDisparityOperation 'Частичная уценка' = DATA BOOLEAN (Operation);

CONSTRAINT useDisparityItemDisparityOperation(operationDisparityDetail(detail))  
    AND inputSkuDisparityDetail(detail) AND skuDisparityDetail(detail) 
    AND NOT (disparityItemItem(inputSkuDisparityDetail(detail))==skuDisparityDetail(detail))
    CHECKED BY inputSkuDisparityDetail MESSAGE 'Выбран не уцененный товар';   
    
EXTEND FORM operation
    PROPERTIES (o) useDisparityItemDisparityOperation 
;

DESIGN operation {
    propertyContainer {
        MOVE PROPERTY(useDisparityItemDisparityOperation(o));
    }
}

@defineDocumentOperationConstraint(disparity, disparities, 'изменения сорткноси', Disparity);
