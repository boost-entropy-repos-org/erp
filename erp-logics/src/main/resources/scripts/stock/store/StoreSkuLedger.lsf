MODULE StoreSkuLedger;

REQUIRE Store, SkuLedger;

NAMESPACE Store;

explicitBatchLedgerDepartmentStore 'Партионный учет' = DATA BOOLEAN (DepartmentStore);
explicitBatchLedgerStock(stock) += explicitBatchLedgerDepartmentStore(stock);

dataPriceBatchLedgerDepartmentStore 'Использовать свои цены для каждой партии' = DATA BOOLEAN (DepartmentStore);
dataPriceBatchLedgerStock(stock) += dataPriceBatchLedgerDepartmentStore(stock);

EXTEND FORM departmentStore
    PROPERTIES(d) explicitBatchLedgerDepartmentStore SHOWIF isCompanyStock(d), dataPriceBatchLedgerDepartmentStore SHOWIF showPriceBatchLedgerStock(d) 
;

DESIGN departmentStore {
    headerExtraParams {
        MOVE PROPERTY(explicitBatchLedgerDepartmentStore(d));
        MOVE PROPERTY(dataPriceBatchLedgerDepartmentStore(d));
    }
}

balanceASkuStoreDateTime 'Остаток' (sku, store, dateTime) =
    GROUP SUM balanceASkuStockDateTime(sku, stock, dateTime)
    BY sku, storeDepartmentStore(stock), dateTime;
balanceASkuStoreDate 'Остаток' (sku, store, date) =
    GROUP SUM balanceASkuStockDate(sku, stock, date)
    BY sku, storeDepartmentStore(stock), date;
        
balanceBSkuStoreDateTime 'Остаток' (sku, store, dateTime) = 
    GROUP SUM balanceBSkuStockDateTime(sku, stock, dateTime) 
    BY sku, storeDepartmentStore(stock), dateTime;
balanceBSkuStoreDate 'Остаток' (sku, store, date) = 
    GROUP SUM balanceBSkuStockDate(sku, stock, date) 
    BY sku, storeDepartmentStore(stock), date;