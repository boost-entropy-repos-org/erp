MODULE StoreSkuLedger;

REQUIRE Store, SkuLedger;

NAMESPACE Store;

explicitBatchLedgerDepartmentStore 'Партионный учет' = DATA BOOLEAN (DepartmentStore);
explicitBatchLedgerStock(stock) += explicitBatchLedgerDepartmentStore(stock);

EXTEND FORM departmentStore
    PROPERTIES(d) SHOWIF isCompanyStock(d) explicitBatchLedgerDepartmentStore
;

EXTEND DESIGN departmentStore {
    headerExtraParams {
        ADD PROPERTY(explicitBatchLedgerDepartmentStore(d));
    }
}

balanceASkuStoreDateTime 'Остаток' (sku, stock, dateTime) =
    GROUP SUM balanceASkuStockDateTime(sku, stock, dateTime)
    BY sku, storeDepartmentStore(stock), dateTime;
balanceASkuStoreDate 'Остаток' (sku, stock, date) =
    GROUP SUM balanceASkuStockDate(sku, stock, date)
    BY sku, storeDepartmentStore(stock), date;
        
balanceBSkuStoreDateTime 'Остаток' (sku, store, dateTime) = 
    GROUP SUM balanceBSkuStockDateTime(sku, stock, dateTime) 
    BY sku, storeDepartmentStore(stock), dateTime;
balanceBSkuStoreDate 'Остаток' (sku, store, date) = 
    GROUP SUM balanceBSkuStockDate(sku, stock, date) 
    BY sku, storeDepartmentStore(stock), date;