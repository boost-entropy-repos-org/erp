MODULE PriceRoundStore;

REQUIRE PriceRound, Store, Country;

//------------------------- Расширяем форму Отдела -------------------------//

dataDiscountRoundConditionDepartmentStore = DATA RoundCondition (DepartmentStore);
nameDiscountDataRoundConditionDepartmentStore 'Условие округления скидки' (departmentStore)= nameRoundCondition(dataDiscountRoundConditionDepartmentStore(departmentStore)) IN bookkeeping;

dataRoundConditionDepartmentStore = DATA RoundCondition (DepartmentStore);
nameDataRoundConditionDepartmentStore 'Условие округления розничной цены' (departmentStore)= nameRoundCondition(dataRoundConditionDepartmentStore(departmentStore)) IN bookkeeping;

roundConditionCountry = DATA RoundCondition(Country);
nameRoundConditionCountry 'Условие округления розничной цены (по умолчанию)' (country)= nameRoundCondition(roundConditionCountry(country));

roundConditionCountryDepartmentStore (departmentStore) = roundConditionCountry(countryLegalEntity(legalEntityDepartmentStore(departmentStore))) PERSISTENT;

roundConditionDepartmentStore (departmentStore) = OVERRIDE roundConditionCountryDepartmentStore(departmentStore), dataRoundConditionDepartmentStore(departmentStore) PERSISTENT;
roundDiscountConditionDepartmentStore (departmentStore) = OVERRIDE roundConditionDepartmentStore(departmentStore), dataDiscountRoundConditionDepartmentStore(departmentStore) PERSISTENT;

CONSTRAINT currencyStock(departmentStore) != currencyRoundCondition(dataRoundConditionDepartmentStore(departmentStore))
           CHECKED BY dataRoundConditionDepartmentStore
           MESSAGE 'Валюта округления должна совпадать с валютой склада';

CONSTRAINT currencyStock(departmentStore) != currencyRoundCondition(dataDiscountRoundConditionDepartmentStore(departmentStore))
           CHECKED BY dataDiscountRoundConditionDepartmentStore
           MESSAGE 'Валюта округления должна совпадать с валютой склада';

CONSTRAINT currencyCountry(country) != currencyRoundCondition(roundConditionCountry(country))
           CHECKED BY roundConditionCountry
           MESSAGE 'Валюта округления должна совпадать с валютой страны';

EXTEND FORM departmentStore
    PROPERTIES(d) nameDataRoundConditionDepartmentStore, nameDiscountDataRoundConditionDepartmentStore
;

DESIGN departmentStore {
    headerExtraParams {
        ADD PROPERTY(nameDataRoundConditionDepartmentStore(d));
        ADD PROPERTY(nameDiscountDataRoundConditionDepartmentStore(d));
    }
}

EXTEND FORM country
    PROPERTIES (c) nameRoundConditionCountry
;