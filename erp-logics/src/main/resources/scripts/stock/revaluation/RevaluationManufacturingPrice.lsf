MODULE RevaluationManufacturingPrice;

REQUIRE Revaluation;

NAMESPACE Revaluation;

//-- До
@defineDocumentInterfaceDetailPriceCustomPrefix(revaluationDetail, curManufacturing, ' изготовителя до');
@deriveDocumentDetailPriceSystemLedgerPriceListTypeBatch(userRevaluation, manufacturingPriceStockPriceListType, curManufacturing, sku, stock);
@defineDocumentInterfaceDetailDataSumPrefix (revaluation, curManufacturing, ' изготовителя до');
@deriveDocumentDetailSumPrefix(userRevaluation, curManufacturing, currency, quantity);

//-- После
@defineDocumentInterfaceDetailPriceCustomPrefix(revaluationDetail, manufacturing, ' изготовителя после');
@defineDocumentInterfaceDetailDataSumPrefix (revaluation, manufacturing, ' изготовителя после');
@deriveDocumentDetailSumPrefix(userRevaluation, manufacturing, currency, quantity);

updatePriceManufacturingUserRevaluation 'Изменять цену учетную на изготовителя' = DATA BOOLEAN (UserRevaluation) IN documentPrm;
EXTEND FORM userRevaluation PROPERTIES(p) updatePriceManufacturingUserRevaluation;

updatePriceManufacturingUserRevaluationDetail(d) = updatePriceManufacturingUserRevaluation(userRevaluationUserRevaluationDetail(d)); 
priceUserRevaluationDetail(detail) <- manufacturingPriceUserRevaluationDetail(detail) 
    WHEN (CHANGED(manufacturingPriceUserRevaluationDetail(detail)) OR CHANGED(updatePriceManufacturingUserRevaluationDetail(detail))) AND updatePriceManufacturingUserRevaluationDetail(detail);

@defineOperationProperty(updatePriceManufacturing, 'Изменять цену учетную на изготовителя', showContainer);
@deriveDocumentOperationProperty(UserRevaluation, updatePriceManufacturing);

// -- Разница
@defineDocumentInterfaceDetailDiffSumPrefix (revaluation, manufacturingSum, , cur, ' изменения изготовителя');

@defineDocumentInterfaceHeaderSumPrefix (revaluation, diffManufacturing, ' изменения изготовителя');


EXTEND FORM userRevaluation
    PROPERTIES(p) BEFORE diffSumUserRevaluationDetailUserRevaluation diffManufacturingSumUserRevaluationDetailUserRevaluation
    PROPERTIES(d) BEFORE curPriceUserRevaluationDetail curManufacturingPriceUserRevaluationDetail, curManufacturingSumUserRevaluationDetail
    PROPERTIES(d) BEFORE priceUserRevaluationDetail manufacturingPriceUserRevaluationDetail, manufacturingSumUserRevaluationDetail
;
EXTEND DESIGN userRevaluation {
        PROPERTY(diffManufacturingSumUserRevaluationDetailUserRevaluation) { preferredCharWidth = 13;}  
}
EXTEND FORM revaluations
    PROPERTIES(p) READONLY BEFORE diffSumRevaluationDetailRevaluation diffManufacturingSumRevaluationDetailRevaluation
    PROPERTIES(d) READONLY BEFORE curPriceRevaluationDetail curManufacturingPriceRevaluationDetail, curManufacturingSumRevaluationDetail
    PROPERTIES(d) READONLY BEFORE priceRevaluationDetail manufacturingPriceRevaluationDetail, manufacturingSumRevaluationDetail
;

inPriceListLedgerSystemLedgerPriceListType (ledger, type) += WHEN CLASS(manufacturingPriceRevaluationDetail(ledger)) AND type == SystemLedgerPriceListType.manufacturingPriceStockPriceListType THEN TRUE;
pricePriceListLedgerSystemLedgerPriceListType (ledger, type) += WHEN CLASS(manufacturingPriceRevaluationDetail(ledger)) AND type == SystemLedgerPriceListType.manufacturingPriceStockPriceListType THEN manufacturingPriceRevaluationDetail(ledger);

