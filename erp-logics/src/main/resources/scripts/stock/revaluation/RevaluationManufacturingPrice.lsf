MODULE RevaluationManufacturingPrice;

REQUIRE Revaluation;

//-- До
@defineDocumentInterfaceDetailPriceCustomPrefix(revaluationDetail, curManufacturing, ' изготовителя до');
@deriveDocumentDetailPriceSystemLedgerPriceListTypeBatch(userRevaluation, manufacturingPriceStockPriceListType, curManufacturing, sku, stock);
@defineDocumentInterfaceDetailDataSumPrefix (revaluation, curManufacturing, ' изготовителя до');
@deriveDocumentDetailSumPrefix(userRevaluation, curManufacturing, currency, quantity);

//-- После
@defineDocumentInterfaceDetailPriceCustomPrefix(revaluationDetail, manufacturing, ' изготовителя после');
@defineDocumentInterfaceDetailDataSumPrefix (revaluation, manufacturing, ' изготовителя после');
@deriveDocumentDetailSumPrefix(userRevaluation, manufacturing, currency, quantity);

priceUserRevaluationDetail(detail) <- manufacturingPriceUserRevaluationDetail(detail) WHEN CHANGED(manufacturingPriceUserRevaluationDetail(detail));

// -- Разница
@defineDocumentInterfaceDetailDiffSumPrefix (revaluation, manufacturingSum, , cur, ' изменения изготовителя');

@defineDocumentInterfaceHeaderSumPrefix (revaluation, diffManufacturing, ' изменения изготовителя');


EXTEND FORM userRevaluation
    PROPERTIES(p) BEFORE diffSumUserRevaluationDetailUserRevaluation diffManufacturingSumUserRevaluationDetailUserRevaluation
    PROPERTIES(d) BEFORE curPriceUserRevaluationDetail curManufacturingPriceUserRevaluationDetail, curManufacturingSumUserRevaluationDetail
    PROPERTIES(d) BEFORE priceUserRevaluationDetail manufacturingPriceUserRevaluationDetail, manufacturingSumUserRevaluationDetail
;

EXTEND FORM revaluations
    PROPERTIES(p) READONLY BEFORE diffSumRevaluationDetailRevaluation diffManufacturingSumRevaluationDetailRevaluation
    PROPERTIES(d) READONLY BEFORE curPriceRevaluationDetail curManufacturingPriceRevaluationDetail, curManufacturingSumRevaluationDetail
    PROPERTIES(d) READONLY BEFORE priceRevaluationDetail manufacturingPriceRevaluationDetail, manufacturingSumRevaluationDetail
;

inPriceListLedgerSystemLedgerPriceListType (ledger, type) += WHEN CLASS(manufacturingPriceRevaluationDetail(ledger)) AND type == SystemLedgerPriceListType.manufacturingPriceStockPriceListType THEN TRUE;
pricePriceListLedgerSystemLedgerPriceListType (ledger, type) += WHEN CLASS(manufacturingPriceRevaluationDetail(ledger)) AND type == SystemLedgerPriceListType.manufacturingPriceStockPriceListType THEN manufacturingPriceRevaluationDetail(ledger);
