MODULE InvoiceMarketing;

REQUIRE ContractMarketing, Invoice;

NAMESPACE Invoice;

percMarketingSupplier '% маркетинга' = ABSTRACT NUMERIC[8,4] (InvoiceDetail);

marketingSum 'Сумма маркетинга'  (InvoiceDetail d) = NUMERIC[18,4](round2(sum(d)*percMarketingSupplier(d)/100.0)) MATERIALIZED; 
marketingSumInvoiceDetail 'Сумма маркетинга'  = GROUP BY invoice(InvoiceDetail d) SUM marketingSum(d); 