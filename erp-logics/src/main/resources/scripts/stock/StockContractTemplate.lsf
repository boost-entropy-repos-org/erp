MODULE StockContractTemplate;

REQUIRE StockContract, Word, LegalEntityBy, Bank;

overCreateStockTemplate = ACTION ABSTRACT LIST (TemplateEntry, Contract);

createStockTemplate 'Заполнить по шаблону'(Contract contract) = ACTION {
    ASSIGN value(TemplateEntry detail) <- NULL;

    SHOW dialogTemplates ;
    IF formResult() == FormResult.ok THEN {
        LOCAL template = Template();
        ASSIGN template() <- chosenObject('t');
        FOR template (TemplateEntry detail) == template() DO {

            ASSIGN value(detail) <- TEXT(nameSupplier(contract)) WHERE key(detail) == 'supplier';
            ASSIGN value(detail) <- TEXT(nameCustomer(contract)) WHERE key(detail) == 'customer';
            ASSIGN value(detail) <- TEXT(shortNameOwnership(supplier(contract))) WHERE key(detail) == 'shortOwnershipSupplier';
            ASSIGN value(detail) <- TEXT(shortNameOwnership(customer(contract))) WHERE key(detail) == 'shortOwnershipCustomer';
            ASSIGN value(detail) <- TEXT(address(supplier(contract))) WHERE key(detail) == 'addressSupplier';
            ASSIGN value(detail) <- TEXT(address(customer(contract))) WHERE key(detail) == 'addressCustomer';
            ASSIGN value(detail) <- TEXT(nameCountry(supplier(contract))) WHERE key(detail) == 'countrySupplier';
            ASSIGN value(detail) <- TEXT(nameCountry(customer(contract))) WHERE key(detail) == 'countryCustomer';
            ASSIGN value(detail) <- TEXT(phone(supplier(contract))) WHERE key(detail) == 'phoneSupplier';
            ASSIGN value(detail) <- TEXT(phone(customer(contract))) WHERE key(detail) == 'phoneCustomer';
            ASSIGN value(detail) <- TEXT(email(supplier(contract))) WHERE key(detail) == 'emailSupplier';
            ASSIGN value(detail) <- TEXT(email(customer(contract))) WHERE key(detail) == 'emailCustomer';
            ASSIGN value(detail) <- TEXT(numberAccount(supplier(contract))) WHERE key(detail) == 'accountBankSupplier';
            ASSIGN value(detail) <- TEXT(numberAccount(customer(contract))) WHERE key(detail) == 'accountBankCustomer';
            ASSIGN value(detail) <- TEXT(nameBank(account(supplier(contract)))) WHERE key(detail) == 'bankSupplier';
            ASSIGN value(detail) <- TEXT(nameBank(account(customer(contract)))) WHERE key(detail) == 'bankCustomer';
            ASSIGN value(detail) <- TEXT(addressBank(account(supplier(contract)))) WHERE key(detail) == 'addressBankSupplier';
            ASSIGN value(detail) <- TEXT(addressBank(account(customer(contract)))) WHERE key(detail) == 'addressBankCustomer';
            ASSIGN value(detail) <- TEXT(MFOBank(account(supplier(contract)))) WHERE key(detail) == 'MFOBankSupplier';
            ASSIGN value(detail) <- TEXT(MFOBank(account(customer(contract)))) WHERE key(detail) == 'MFOBankCustomer';
            ASSIGN value(detail) <- TEXT(departmentBank(account(supplier(contract)))) WHERE key(detail) == 'departmentBankSupplier';
            ASSIGN value(detail) <- TEXT(departmentBank(account(customer(contract)))) WHERE key(detail) == 'departmentBankCustomer';
            ASSIGN value(detail) <- TEXT(CBUBank(account(supplier(contract)))) WHERE key(detail) == 'CBUBankSupplier';
            ASSIGN value(detail) <- TEXT(CBUBank(account(customer(contract)))) WHERE key(detail) == 'CBUBankCustomer';

            EXEC overCreateStockTemplate(detail, contract);
        }
        SHOW template OBJECTS t = template() ;
        IF formResult() == FormResult.ok THEN {
            EXEC process(template());
            ASSIGN word[UserContractSku](contract) <- resultTemplate();
            EXEC openWord[UserContractSku](contract);
        }
    }
} IMAGE 'editReport.png';

EXTEND FORM userContractSku

    PROPERTIES (c) createStockTemplate
;
DESIGN userContractSku {
    text {
        MOVE PROPERTY(createStockTemplate(c));
    }
}

// ----------------------------------- Стандартные данные ----------------------------------- //

loadDefaultTemplate 'Добавить шаблон договора'(VARSTRING[100] iname, VARISTRING[100] isid) = ACTION {
    FOR NEW t = Template DO {
        ASSIGN name(t) <- iname;
        ASSIGN id(t) <- isid;
    }
}

loadDefaultTemplateEntry 'Добавить строку шаблона'(VARSTRING[100] iname, VARISTRING[100] isid) = ACTION {
    FOR NEW g = TemplateEntry DO {
        ASSIGN key(g) <- iname;
        ASSIGN template(g) <- templateId(isid);
    }
}

overloadDefaultTemplates = ACTION ABSTRACT LIST ();
loadDefaultTemplates 'Загрузить стандартные шаблоны' () = ACTION  {
    EXEC loadDefaultTemplate ('Договор купли продажи', '1');

    EXEC loadDefaultTemplateEntry('supplier', '1');
    EXEC loadDefaultTemplateEntry('customer', '1');
    EXEC loadDefaultTemplateEntry('shortOwnershipSupplier', '1');
    EXEC loadDefaultTemplateEntry('shortOwnershipCustomer', '1');
    EXEC loadDefaultTemplateEntry('addressSupplier', '1');
    EXEC loadDefaultTemplateEntry('addressCustomer', '1');
    EXEC loadDefaultTemplateEntry('managerSupplier', '1');
    EXEC loadDefaultTemplateEntry('managerCustomer', '1');
    EXEC loadDefaultTemplateEntry('countrySupplier', '1');
    EXEC loadDefaultTemplateEntry('countryCustomer', '1');
    EXEC loadDefaultTemplateEntry('phoneSupplier', '1');
    EXEC loadDefaultTemplateEntry('phoneCustomer', '1');
    EXEC loadDefaultTemplateEntry('emailSupplier', '1');
    EXEC loadDefaultTemplateEntry('emailCustomer', '1');
    EXEC loadDefaultTemplateEntry('accountBankSupplier', '1');
    EXEC loadDefaultTemplateEntry('accountBankCustomer', '1');
    EXEC loadDefaultTemplateEntry('bankSupplier', '1');
    EXEC loadDefaultTemplateEntry('bankCustomer', '1');
    EXEC loadDefaultTemplateEntry('addressBankSupplier', '1');
    EXEC loadDefaultTemplateEntry('addressBankCustomer', '1');
    EXEC loadDefaultTemplateEntry('MFOBankSupplier', '1');
    EXEC loadDefaultTemplateEntry('MFOBankCustomer', '1');
    EXEC loadDefaultTemplateEntry('departmentBankSupplier', '1');
    EXEC loadDefaultTemplateEntry('departmentBankCustomer', '1');
    EXEC loadDefaultTemplateEntry('CBUBankSupplier', '1');
    EXEC loadDefaultTemplateEntry('CBUBankCustomer', '1');

    EXEC overloadDefaultTemplates();
} IN loadDefault;

@implementLoadDefaultData(loadDefaultTemplates);



