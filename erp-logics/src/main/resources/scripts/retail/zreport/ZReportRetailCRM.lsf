MODULE ZReportRetailCRM;

REQUIRE ZReportDiscountCard, RetailCRM;

NAMESPACE ZReport;

// ----------------------------------- Расчет сумм скидок ------------------------------------- // 
TABLE receiptSaleDetailPromotionCondition(ReceiptSaleDetail, PromotionCondition);
quantityReceiptSaleDetailPromotionCondition 'Кол-во по акции' = DATA NUMERIC[14,3] (ReceiptSaleDetail, PromotionCondition) INDEXED;
promotionSumReceiptSaleDetailPromotionCondition 'Сумма скидки' = DATA NUMERIC[16,2] (ReceiptSaleDetail, PromotionCondition);
setUserPromotionReceiptSaleDetailPromotionCondition 'Применить скидку' = DATA BOOLEAN (ReceiptSaleDetail, PromotionCondition);

idPromotionConditionsReceiptSaleDetail 'Коды акций' (d) = GROUP CONCAT idPromotionCondition(p) IF quantityReceiptSaleDetailPromotionCondition(d, p),
                                                      ','
                                                      BY d
                                                      ORDER p;