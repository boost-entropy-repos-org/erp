MODULE RepricingDisparityManufacturingPrice;

REQUIRE RepricingDisparity, RepricingManufacturingPrice, PriceListLedger;

@defineDocumentDetailPriceCustomPrefix(disparityDetail, curInputManufacturing, ' изготовителя до');
@deriveDocumentDetailPriceSystemLedgerPriceListType(disparity, manufacturingPriceStockPriceListType, curInputManufacturing, sku, stock);

@defineDocumentDetailPriceCustomPrefix(disparityDetail, afterInputManufacturing, ' изготовителя после');

overCurRepricingPriceRepricingDetail(detail) += curInputManufacturingPriceDisparityDetail(disparityDetailDisparityRepricingDetail(detail));
overCurInputRepricingPriceDisparityDetail(detail) += curInputManufacturingPriceDisparityDetail(detail);
curManufacturingPriceRepricingDetail(detail) += curInputManufacturingPriceDisparityDetail(disparityDetailDisparityRepricingDetail(detail));

overRepricingPriceRepricingDetail(detail) += afterInputManufacturingPriceDisparityDetail(disparityDetailDisparityRepricingDetail(detail));
overAfterInputRepricingPriceDisparityDetail(detail) += afterInputManufacturingPriceDisparityDetail(detail);
manufacturingPriceRepricingDetail(detail) += afterInputManufacturingPriceDisparityDetail(disparityDetailDisparityRepricingDetail(detail));

afterInputManufacturingPriceDisparityDetail(detail) <- curInputManufacturingPriceDisparityDetail(detail) WHEN CHANGED (curInputManufacturingPriceDisparityDetail(detail));

@changeDocumentDetailPricePrefix(disparityDetail, curInputManufacturing, curInput, curInput, curInputManufacturing, curInput, curInputRetail);
@changeDocumentDetailPricePrefix(disparityDetail, afterInputManufacturing, afterInput, afterInput, afterInputManufacturing, afterInput, afterInputRetail);

EXTEND FORM disparity
    PROPERTIES(d)  BACKGROUND backgroundCurDisparity(dis) SHOWIF createRepricingDisparity(dis)
                   curInputManufacturingPriceDisparityDetail ON CHANGE changeCurInputManufacturingPriceDisparityDetail(d) BEFORE curInputPriceDisparityDetail(d)
    PROPERTIES(d)  BACKGROUND backgroundAfterDisparity(dis) SHOWIF createRepricingDisparity(dis)
                   afterInputManufacturingPriceDisparityDetail ON CHANGE changeAfterInputManufacturingPriceDisparityDetail(d) BEFORE afterInputPriceDisparityDetail(d)
;
EXTEND FORM disparities
    PROPERTIES(d)  READONLY BACKGROUND backgroundCurDisparity(dis) SHOWIF createRepricingDisparity(dis) curInputManufacturingPriceDisparityDetail BEFORE curInputPriceDisparityDetail(d)
    PROPERTIES(d)  READONLY BACKGROUND backgroundAfterDisparity(dis) SHOWIF createRepricingDisparity(dis) afterInputManufacturingPriceDisparityDetail BEFORE afterInputPriceDisparityDetail(d)
;

