MODULE RepricingPurchaseShipment;

REQUIRE Repricing, PurchaseShipmentTax;

NAMESPACE Repricing;

lastValueVATSkuStockDateTime(s, st, dt) = GROUP LAST valueVATBatch(b)
                                                                                   BY skuBatch(b), st, dt
                                                                                   ORDER orderBatch(b)
                                                                                   WHERE countLedgerBatchStock(b, st) AND valueVATBatch(b) AND dateTimeBatch(b) < dt COMPLEX; 
lastValueVATUserRepricingDetail(d) = lastValueVATSkuStockDateTime(skuUserRepricingDetail(d), departmentStoreUserRepricingDetail(d), dateTimeUserRepricingDetail(d));  

overDeriveValueCurVATUserRepricingDetail(d) += OVERRIDE lastValueVATUserRepricingDetail(d), valueVATBatch(batchUserRepricingDetail(d));
overDeriveValueVATUserRepricingDetail(d) += OVERRIDE lastValueVATUserRepricingDetail(d), valueVATBatch(batchUserRepricingDetail(d));