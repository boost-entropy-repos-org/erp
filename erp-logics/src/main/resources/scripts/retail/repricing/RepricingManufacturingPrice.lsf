MODULE RepricingManufacturingPrice;

REQUIRE Repricing, PriceListLedger, PurchaseManufacturingPrice, PricingManufacturingPrice;

@defineDocumentInterfaceDetailPriceCustomPrefix(repricingDetail, manufacturing, ' изготовителя после');

@defineDocumentInterfaceDetailPriceCustomPrefix(repricingDetail, curManufacturing, ' изготовителя до');
//@deriveDocumentDetailPriceSystemLedgerPriceListType(userRepricing, manufacturingPriceStockPriceListType, curManufacturing, sku, departmentStore);
@deriveDocumentDetailPriceSystemLedgerPriceListTypeBatch (userRepricing, manufacturingPriceStockPriceListType, curManufacturing, sku, departmentStore);
overRecalculatePriceUserRepricingDetail(d) +=  ACTION (d) {
    curManufacturingPriceUserRepricingDetail (d)  <- IF batchUserRepricingDetail(d)
        THEN prevPriceBPriceListTypeBatchStockDateTime(SystemLedgerPriceListType.manufacturingPriceStockPriceListType,
                    batchUserRepricingDetail(d),
                    departmentStoreUserRepricingDetail(d),
                    dateTimeUserRepricingDetail(d))
        ELSE prevPriceBPriceListTypeSkuStockDateTime(SystemLedgerPriceListType.manufacturingPriceStockPriceListType,
                    skuUserRepricingDetail(d),
                    departmentStoreUserRepricingDetail(d),
                    dateTimeUserRepricingDetail(d));
}  
                                                       
overConfirmRecalculatePriceUserRepricingDetail(d) +=  ACTION (d) {
    manufacturingPriceUserRepricingDetail (d)  <- curManufacturingPriceUserRepricingDetail(d);
}                                                       

manufacturingPriceUserRepricingDetail(d) <- curManufacturingPriceUserRepricingDetail(d) WHEN 
    CHANGED(skuUserRepricingDetail(d)) OR
    CHANGED(departmentStoreUserRepricingDetail(d)) OR
    CHANGED(dateTimeUserRepricingDetail(d)) OR
    CHANGED(batchUserRepricingDetail(d));

@changeDocumentDetailPricePrefix(userRepricingDetail, curManufacturing, cur, cur, curManufacturing, cur, curRetail);
@changeDocumentDetailPricePrefix(userRepricingDetail, manufacturing, newRetail, , manufacturing, , retail);

overRepricingPriceUserRepricingDetail(detail) += manufacturingPriceUserRepricingDetail(detail) IF NOT skipCalcPricingManufacturingPrice();
overCurRepricingPriceUserRepricingDetail(detail) += curManufacturingPriceUserRepricingDetail(detail) IF NOT skipCalcPricingManufacturingPrice();

EXTEND FORM userRepricing
    PROPERTIES(d) manufacturingPriceUserRepricingDetail ON CHANGE changeManufacturingPriceUserRepricingDetail(d) BEFORE priceUserRepricingDetail(d),
                  curManufacturingPriceUserRepricingDetail ON CHANGE changeCurManufacturingPriceUserRepricingDetail(d) BEFORE curPriceUserRepricingDetail(d)

;
DESIGN userRepricing{
    PROPERTY(manufacturingPriceUserRepricingDetail(d)) { background = #FFFFCC; }
}

EXTEND FORM repricings
    PROPERTIES(d) READONLY manufacturingPriceRepricingDetail BEFORE priceRepricingDetail(d), curManufacturingPriceRepricingDetail BEFORE curPriceRepricingDetail(d)
;

overChangePriceUserRepricing(userRepricingDetail) += ACTION (userRepricingDetail) {
    ASSIGN manufacturingPriceUserRepricingDetail(userRepricingDetail) <- curManufacturingPriceUserRepricingDetail(userRepricingDetail);
}

