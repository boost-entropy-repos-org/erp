MODULE SaleStatisticsStore;

REQUIRE SaleStatistics, ZReport;

NAMESPACE Sale;

EXTEND FORM statisticalReport

    PROPERTIES  FORCE PANEL sumCardDepartmentStoreDateFromTo(ts, dFrom, dTo), sumSaleDepartmentStoreDateFromTo(ts, dFrom, dTo)
;
DESIGN statisticalReport {
    row {
        NEW row2 {
        caption = 'По отделу, cум..';
        ADD PROPERTY(sumCardDepartmentStoreDateFromTo(ts,dFrom,dTo));
        ADD PROPERTY(sumSaleDepartmentStoreDateFromTo(ts,dFrom,dTo));
        }
    }
}

retailSumCardLegalEntityRegionDateFromTo 'Продано с использованием банк. карточек' (legalEntity, region, dateFrom, dateTo) =
    GROUP SUM  sumCardDepartmentStoreDateFromTo(stock, dateFrom, dateTo)
        BY legalEntityStock(stock), regionStock(stock), dateFrom, dateTo;

retailSumSaleLegalEntityRegionDateFromTo 'Продано по кассе' (legalEntity, region, dateFrom, dateTo) =
    GROUP SUM  sumSaleDepartmentStoreDateFromTo(stock, dateFrom, dateTo)
        BY legalEntityStock(stock), regionStock(stock), dateFrom, dateTo;

EXTEND FORM torgSales
    PROPERTIES(l, r, dFrom, dTo) retailSumSaleLegalEntityRegionDateFromTo, retailSumCardLegalEntityRegionDateFromTo
;
DESIGN torgSales {
    main {
        NEW secondCase BEFORE functions.box {
            type = CONTAINERH;
            caption = 'Суммы, руб.';
            ADD PROPERTY(retailSumSaleLegalEntityRegionDateFromTo(l,r,dFrom,dTo));
            ADD PROPERTY(retailSumCardLegalEntityRegionDateFromTo(l,r,dFrom,dTo));
        }
    }
}