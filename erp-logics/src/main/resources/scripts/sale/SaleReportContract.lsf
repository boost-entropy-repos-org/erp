MODULE SaleReportContract;

REQUIRE SaleReport, ContractPayment;

NAMESPACE SaleReport;

@implementContractLedger(a, SaleReport, contractSku);

sum[ContractALedger](SaleReport contractALedger) +=
    IF currency(contractALedger) != currency(contractSku(contractALedger)) THEN 
        NUMERIC[16,2](invoiceSumSaleReportDetail(contractALedger) * 
                      rateOn(typeExchange(contractSku(contractALedger)), 
                                                     currency(contractALedger),
                                                     date(contractALedger)))
    ELSE 
        invoiceSumSaleReportDetail(contractALedger);
        

@implementContractLedger(, SaleReport, contractSku);

sum[ContractLedger](SaleReport contractLedger) +=
    IF currency(contractLedger) != currency(contractSku(contractLedger)) THEN 
        NUMERIC[16,2](invoiceSumSaleReportDetail(contractLedger) * 
                      rateOn(typeExchange(contractSku(contractLedger)), 
                                                     currency(contractLedger),
                                                     date(contractLedger)))
    ELSE 
        invoiceSumSaleReportDetail(contractLedger);
        
EXTEND CLASS SaleReport : InContractLedger;
@implementInOutContractLedgerPrefix(in, SaleReport, contractSku);
number[InContractLedger](SaleReport inContractLedger) += number(inContractLedger);
series[InContractLedger](SaleReport inContractLedger) += series(inContractLedger);    
customerStock[InContractLedger](SaleReport inContractLedger) += companyStock(inContractLedger);

edit[InContractLedger](SaleReport ledger) += ACTION edit(ledger);    

sum[InContractLedger](SaleReport inContractLedger) +=
    IF currency(inContractLedger) != currency(contractSku(inContractLedger)) THEN 
        NUMERIC[16,2](invoiceSumSaleReportDetail(inContractLedger) * 
                      rateOn(typeExchange(contractSku(inContractLedger)), 
                                                     currency(inContractLedger),
                                                     date(inContractLedger)))
    ELSE 
        invoiceSumSaleReportDetail(inContractLedger);