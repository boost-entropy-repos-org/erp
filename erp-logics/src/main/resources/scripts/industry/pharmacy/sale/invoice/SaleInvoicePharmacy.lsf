MODULE SaleInvoicePharmacy;

REQUIRE SaleInvoice, StockPharmacy, ItemPharmacyBy;

NAMESPACE Sale;

seriesPharmacy 'Серия лекарственного средства' = seriesPharmacy(batch(InvoiceDetail detail));
seriesPharmacy 'Серия лекарственного средства' = seriesPharmacy(batch(UserInvoiceDetail detail));

namePharmacyPriceGroup 'Тип лекарственного средства' = namePharmacyPriceGroup(batch(InvoiceDetail detail));
namePharmacyPriceGroup 'Тип лекарственного средства' = namePharmacyPriceGroup(batch(UserInvoiceDetail detail));

nameImportCountry 'Страна ввоза' = nameImportCountry(batch(UserInvoiceDetail detail)) MINCHARWIDTH 15 PREFCHARWIDTH 15;

EXTEND FORM userInvoice
    PROPERTIES(d) READONLY seriesPharmacy SHOWIF showSeriesPharmacy() AFTER nameBatch(d),
                           namePharmacyPriceGroup SHOWIF showSeriesPharmacy() AFTER nameBatch(d)                   
;

EXTEND FORM invoices
    PROPERTIES(d) READONLY seriesPharmacy SHOWIF showSeriesPharmacy() AFTER nameBatch(d),
                           namePharmacyPriceGroup SHOWIF showSeriesPharmacy() AFTER nameBatch(d)
;

skipDeriveOrderPrice (UserInvoiceDetail d) += priceListType(d) IS WholesalePharmacyPriceListType AND priceOrder(d) > priceB(priceListType(d), sku(d), supplierStock(d), dateTime(d));
