MODULE RepricingPharmacy;

REQUIRE RepricingPriceDivider, ItemPharmacy;

NAMESPACE Repricing;


blisterAmount 'Кол-во блистеров (в ед.)' = ABSTRACT INTEGER(RepricingDetail) MINCHARWIDTH 3 PREFCHARWIDTH 6;    
blisterAmount 'Кол-во блистеров (в ед.)' = DATA INTEGER(UserRepricingDetail) MINCHARWIDTH 3 PREFCHARWIDTH 6;

blisterAmount (UserRepricingDetail detail) += blisterAmount(detail);
         
setBlisterAmount (UserRepricingDetail detail) = {
    INPUTX i = INTEGER DO  
        blisterAmount(detail) <- i IF i != 0;
}         

EXTEND FORM userRepricing
    PROPERTIES (d) blisterAmount ON CHANGE setBlisterAmount(d) AFTER quantity(d)    
;

EXTEND FORM repricings
    PROPERTIES (d) READONLY blisterAmount AFTER quantity(d)    
;
          
WHEN SESSION FORMS userRepricing GOAFTER sku[UserRepricingDetail] CHANGED(sku(UserRepricingDetail detail)) DO {
    blisterAmount(detail) <- blisterAmount(sku(detail));    
} 
          

priceDivider(UserRepricingDetail detail) += blisterAmount(detail);
