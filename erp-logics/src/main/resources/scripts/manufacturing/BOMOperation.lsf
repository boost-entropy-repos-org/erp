MODULE BOMOperation;

REQUIRE BOM, ProductionOperation, ProductionOrder;

NAMESPACE Production;

operation = DATA Operation (BOM) ;
nameOperation 'Операция' = name(operation(BOM bom)) IN documentPrm;

overCopy (BOM BOM, BOM b) += ACTION {
    operation(b) <- operation(BOM);
}

EXTEND FORM BOM 
    PROPERTIES (b) nameOperation
;

DESIGN BOM {
    b.documentPrm {
        type = COLUMNS;
        columns = 3;
    }
}

EXTEND FORM BOMs 
    PROPERTIES (b) READONLY nameOperation AFTER name(b)
;

CONSTRAINT equalsBOMNettoNetWeight(operation(BOM b)) AND overNettoNetWeightProduct(b) != overNettoNetWeightComponent(b)
    MESSAGE 'Вес нетто компонентов не равен весу нетто изделий в спецификации';
    
EXTEND FORM BOMs FILTERS in(currentUser(), operation(b));