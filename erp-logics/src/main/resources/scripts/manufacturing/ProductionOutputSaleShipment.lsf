MODULE ProductionOutputSaleShipment;

REQUIRE ProductionOutput, SalePurchaseShipment;

NAMESPACE Production;

createShipment 'Создать поставку для ГП'(Output output) = ACTION   {

    FOR ADDOBJ sh = Sale.UserShipment DO {
        supplier(sh) <- legalEntityStock(output);
        customer(sh) <- legalEntityStock(output);
        supplierStock(sh) <- stock(output);
        createPurchase(sh) <- TRUE;
        note(sh) <- VARSTRING[100](description(output));

        FOR output(OutputDetail outputDetail)== output ADDOBJ d = Sale.UserShipmentDetail DO {
            userShipment(d) <- sh;
            sku(d) <- sku(outputDetail);
            quantity(d) <- quantity(outputDetail);
            price(d) <- price(outputDetail);
        }

    FORM Sale.userShipment OBJECTS s=sh MODAL;
        IF formResult() == FormResult.ok THEN {
            apply();
        }
    }
} TOOLBAR;

EXTEND FORM outputs
    PROPERTIES (o) createShipment
;
