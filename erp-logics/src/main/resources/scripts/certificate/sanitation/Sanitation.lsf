MODULE Sanitation;

REQUIRE Certificate, Shipment;

CLASS Sanitation 'ГГР' : Certificate;
TABLE sanitation(Sanitation);

@defineDocumentHeaderTimePrefix(Sanitation, ,' документа');
@deriveDocumentHeaderTimePrefix(Sanitation, );
dateCertificate(sanitation) += dateSanitation(sanitation);
timeCertificate(sanitation) += timeSanitation(sanitation);

@defineDocumentHeaderTimePrefix(Sanitation, from, ' с');
fromDateCertificate(certificate) += fromDateSanitation(certificate);
fromTimeCertificate(certificate) += fromTimeSanitation(certificate);

@defineDocumentHeaderTimePrefix(Sanitation, to, ' по');
//toDateSanitation 'Дата по' = DATA DATE(Sanitation);
//toTimeSanitation 'Время по' = DATA TIME(Sanitation);
//toDateTimeSanitation 'Дата/время по'(sanitation) = dateTimeToDateTime(toDateSanitation(sanitation), toTimeSanitation(sanitation));
toDateCertificate(certificate) += toDateSanitation(certificate);
toTimeCertificate(certificate) += toTimeSanitation(certificate);

numberSanitation 'Номер' = DATA STRING[100] (Sanitation) IN numbered MINCHARWIDTH 10;
seriesSanitation 'Серия' = DATA STRING[2] (Sanitation) IN numbered FIXEDCHARWIDTH 3; 

seriesNumberSanitation 'Серия/Номер' (o) = 
    CONCAT '', seriesSanitation(o), numberSanitation(o) 
    MINCHARWIDTH 7 PREFCHARWIDTH 10 MAXCHARWIDTH 20 PERSISTENT;

seriesCertificate(sanitation) += seriesSanitation(sanitation);
numberCertificate(sanitation) += numberSanitation(sanitation);

descriptionSanitation 'ГГР' (sanitation) = CONCAT ' ', seriesNumberSanitation(sanitation), 'от ' + fromDateSanitation(sanitation), 'по ' + toDateSanitation(sanitation);

@defineBatchCertificate(sanitation, Sanitation, 'ГГР');

FORM sanitation 'ГГР'
    OBJECTS s = Sanitation FIXED PANEL
    PROPERTIES(s) numberSanitation, seriesSanitation, dateSanitation, timeSanitation,
                  fromDateSanitation, fromTimeSanitation, toDateSanitation, toTimeSanitation

    EDIT Sanitation OBJECT s
;

DESIGN sanitation FROM DEFAULT{
    main{
        NEW topContainer{
            type = CONTAINERV;
            NEW headContainer {
                caption = 'Шапка документа';
                type = CONTAINERH;
                ADD PROPERTY (numberSanitation);
                ADD PROPERTY (seriesSanitation);
                ADD PROPERTY (dateSanitation);
                ADD PROPERTY (timeSanitation);

            }
            NEW row {
                NEW timeContainer{
                    caption = 'Период действия';
                    type = CONTAINERH;
                    ADD PROPERTY (fromDateSanitation);
                    ADD PROPERTY (fromTimeSanitation);
                    ADD PROPERTY (toDateSanitation);
                    ADD PROPERTY (toTimeSanitation);
                }
            }
        }
    }
    ADD functions.box;
}

FORM sanitations 'ГГР'
    OBJECTS s = Sanitation
    PROPERTIES(s) READONLY numberSanitation, seriesSanitation, dateSanitation, timeSanitation,
                  fromDateSanitation, fromTimeSanitation, toDateSanitation, toTimeSanitation
    PROPERTIES(s) ADDFORM, EDITFORM, DELETE FORCE PANEL TOOLBAR
;

FORM sanitationsDialog 'ГГР'
    OBJECTS s = Sanitation
    PROPERTIES(s) READONLY numberSanitation, seriesSanitation, dateSanitation, timeSanitation,
                  fromDateSanitation, fromTimeSanitation, toDateSanitation, toTimeSanitation

    DIALOG Sanitation OBJECT s
;

NAVIGATOR {
    customsDocuments {
        ADD sanitations;
    }
}