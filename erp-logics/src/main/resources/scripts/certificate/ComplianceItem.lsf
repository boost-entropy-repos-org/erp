MODULE ComplianceItem;

REQUIRE Compliance, CustomsGroupItem;

isCompliancedCustomsGroupCountryItem 'Необходимость сертификации' (country, item) = isCompliancedCustomsGroup(customsGroupCountryItem(country, item));

isCompliancedCountryItem 'Необходимость сертификации' = DATA BOOLEAN(Country, Item);
isCompliancedCountrySku(country, sku) += isCompliancedCountryItem(country, sku);

isCompliancedCountryItem(country, item) <- isCompliancedCustomsGroupCountryItem(country, item) WHEN CHANGED(customsGroupCountryItem(country, item));

isCompliancedDefaultCountryItem 'Необходимость сертификации' (item) = isCompliancedCountryItem (defaultCountry(), item);

changeCompliancedCountryItem = ACTION (item) {
    REQUEST BOOLEAN INPUT;
    IF requestedLogical() THEN {
        isCompliancedCountryItem(country, item) <- TRUE WHERE country == defaultCountry();
    } ELSE {
        isCompliancedCountryItem(country, item) <- NULL WHERE country == defaultCountry();
    }
}

EXTEND FORM item
    PROPERTIES(c, i) isCompliancedCountryItem
    PROPERTIES(i) isCompliancedDefaultCountryItem ON CHANGE changeCompliancedCountryItem(i)
;
EXTEND DESIGN item { regionPrm  { ADD PROPERTY(isCompliancedDefaultCountryItem); } }

overCopyItem(s, d) += ACTION (s, d) {
    ASSIGN isCompliancedCountryItem(c,d) <- isCompliancedCountryItem(c,s) WHERE isCompliancedCountryItem(c,s);
}

