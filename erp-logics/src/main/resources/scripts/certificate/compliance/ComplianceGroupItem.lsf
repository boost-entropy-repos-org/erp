MODULE ComplianceGroupItem;

REQUIRE ComplianceGroup, Item;

NAMESPACE Compliance;

complianceGroup = DATA ComplianceGroup(Country, Item);
nameComplianceGroup 'Группа сертификации' (Country country, Item item) = name(complianceGroup(country, item)) MINCHARWIDTH 30 PREFCHARWIDTH 40;

complianceGroup(Country country, Item sku) += complianceGroup(country, sku);

complianceGroupDefaultCountry (Item item) = complianceGroup (defaultCountry(), item);
nameComplianceGroupDefaultCountry 'Группа сертификации' (Item item) = name(complianceGroupDefaultCountry(item));

changeComplianceGroupCountry(Item item) = ACTION {
    REQUEST OBJECT cg SHOW complianceGroups ;
    IF requestedObject() THEN {
        complianceGroup(Country country, item) <- requestedObject() WHERE country == defaultCountry();
    } ELSE {
        complianceGroup(Country country, item) <- NULL WHERE country == defaultCountry();
    }
}

EXTEND FORM item
    PROPERTIES(c, i) nameComplianceGroup
    PROPERTIES(i) nameComplianceGroupDefaultCountry ON CHANGE changeComplianceGroupCountry(i)
;
DESIGN item { regionPrm  { MOVE PROPERTY(nameComplianceGroupDefaultCountry(i)); } }

overCopy(Item s, Item d) += ACTION {
    complianceGroup(Country c,d) <- complianceGroup(c,s) WHERE complianceGroup(c,s);
}

