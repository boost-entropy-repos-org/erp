MODULE ComplianceGroupItem;

REQUIRE ComplianceGroup, Item;

complianceGroupCountryItem = DATA ComplianceGroup(Country, Item);
nameComplianceGroupCountryItem 'Группа сертификации' (country, item) = nameComplianceGroup(complianceGroupCountryItem(country, item)) MINCHARWIDTH 30 PREFCHARWIDTH 40;

complianceGroupCountrySku(country, sku) += complianceGroupCountryItem(country, sku);

complianceGroupDefaultCountryItem (item) = complianceGroupCountryItem (defaultCountry(), item);
nameComplianceGroupDefaultCountryItem 'Группа сертификации' (item) = nameComplianceGroup(complianceGroupDefaultCountryItem(item));

changeComplianceGroupCountryItem = ACTION (item) {
    REQUEST OBJECT cg FORM complianceGroups MODAL;
    IF requestedObject() THEN {
        complianceGroupCountryItem(country, item) <- requestedObject() WHERE country == defaultCountry();
    } ELSE {
        complianceGroupCountryItem(country, item) <- NULL WHERE country == defaultCountry();
    }
}

EXTEND FORM item
    PROPERTIES(c, i) nameComplianceGroupCountryItem
    PROPERTIES(i) nameComplianceGroupDefaultCountryItem ON CHANGE changeComplianceGroupCountryItem(i)
;
EXTEND DESIGN item { regionPrm  { ADD PROPERTY(nameComplianceGroupDefaultCountryItem); } }

overCopyItem(s, d) += ACTION (s, d) {
    complianceGroupCountryItem(c,d) <- complianceGroupCountryItem(c,s) WHERE complianceGroupCountryItem(c,s);
}

