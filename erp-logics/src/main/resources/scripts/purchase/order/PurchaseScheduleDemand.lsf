MODULE PurchaseScheduleDemand;

REQUIRE PurchaseScheduleOrder, PurchaseDemand;

NAMESPACE Purchase;

overCreate(UserOrder o) += ACTION {
    dateFromSoldPeriod(o) <-  fromShipmentDate(o);   
}

overCreateDetail(UserOrder userOrder) += ACTION {
    IF isRecommended(userOrder) THEN {
        executeLocalEvents();
        
        IF isCycled(scheduleOrder(scheduleOrderDetail(userOrder))) THEN {
            FOR order(OrderDetail orderDetail) == prevLastCreatedOrder(scheduleOrder(scheduleOrderDetail(userOrder))) DO {
                FOR NEW d=UserOrderDetail DO {
                    userOrder(d) <- userOrder;
                    sku(d) <- sku(orderDetail);
                    quantity(d) <- quantity(orderDetail);
//                    EXEC overCopy(d, orderDetail);
                }
            }
        } ELSE
            fillRecommendedQuantityStock(userOrder);    
    }
};
