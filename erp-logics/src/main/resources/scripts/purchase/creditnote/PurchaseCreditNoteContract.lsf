MODULE PurchaseCreditNoteContract;

REQUIRE PurchaseCreditNote, PurchaseInvoiceContract;

NAMESPACE Purchase;

paymentCondition(InvoiceCreditNote creditNote) += paymentCondition(invoice(creditNote));

//------------------- Проведение по регистру задолженностей ----------------------- //

@implementContractLedger(, CreditNote, contractSku);
sum[ContractLedger](CreditNote contractLedger) +=
    IF currency(contractLedger) != currency(contractSku(contractLedger)) THEN 
        NUMERIC[18,4](-invoiceSumCreditNoteDetail(contractLedger) * 
                      rateOn(typeExchange(contractSku(contractLedger)), 
                                                     currency(contractLedger),
                                                     date(contractLedger)))
    ELSE 
        -invoiceSumCreditNoteDetail(contractLedger);

@implementContractLedger(a, CreditNote, contractSku);
sum[ContractALedger](CreditNote contractALedger) +=
    IF currency(contractALedger) != currency(contractSku(contractALedger)) THEN 
        NUMERIC[18,4](-invoiceSumCreditNoteDetail(contractALedger) * 
                      rateOn(typeExchange(contractSku(contractALedger)), 
                                                     currency(contractALedger),
                                                     date(contractALedger)))
    ELSE 
        -invoiceSumCreditNoteDetail(contractALedger);

@implementOutContractLedger(CreditNote, contractSku);
sum[OutContractLedger](CreditNote outContractLedger) +=
    IF currency(outContractLedger) != currency(contractSku(outContractLedger)) THEN 
        NUMERIC[18,4](invoiceSumCreditNoteDetail(outContractLedger) * 
                      rateOn(typeExchange(contractSku(outContractLedger)), 
                                                     currency(outContractLedger),
                                                     date(outContractLedger)))
    ELSE 
        invoiceSumCreditNoteDetail(outContractLedger);
