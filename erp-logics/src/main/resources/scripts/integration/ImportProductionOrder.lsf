MODULE ImportProductionOrder;

REQUIRE System,
        ImportDocument,
        ProductionOrder,
        ProductionOutput;

EXTEND CLASS ImportTypeDetail {
    componentsPrice 'Цена компонента',
    markup 'Наценка изделия',
    outputQuantity 'Количество произведённое',
    idProduct 'Код изделия',
    idProductsStock 'Код склада изделий',
    costPrice 'Себестоимость изделия'    
}

importProductionOrderDataAction 'Импортировать заказ' = ACTION CUSTOM 'lsfusion.erp.integration.universal.productionorder.ImportProductionOrderActionProperty' (Production.Order);
importProductionOrdersDataAction 'Импортировать заказы из директорий' = ACTION CUSTOM 'lsfusion.erp.integration.universal.productionorder.ImportProductionOrdersActionProperty' ();
importProductionOrdersFileDataAction 'Импортировать заказы из файла' = ACTION CUSTOM 'lsfusion.erp.integration.universal.productionorder.ImportProductionOrdersFileActionProperty' ();
importTypeOrders = DATA ImportType();
nameImportTypeOrders 'Тип импорта' () = nameImportType(importTypeOrders());

importTypeOrder = DATA ImportType(Production.Order);
nameImportTypeOrder 'Тип импорта' (order) = nameImportType(importTypeOrder(order));

EXTEND FORM Production.orders
    PROPERTIES() TODRAW pd TOOLBAR importProductionOrdersDataAction, importProductionOrdersFileDataAction, nameImportTypeOrders
;

DESIGN Production.orders{
    documentDetail {
        NEW importUniversal {
            caption = 'Импорт';
            MOVE PROPERTY(importProductionOrdersDataAction());
            MOVE PROPERTY(importProductionOrdersFileDataAction());
            MOVE PROPERTY(nameImportTypeOrders());                   
        }
    }
}

EXTEND FORM integrationData
    PROPERTIES() importProductionOrdersDataAction, importProductionOrdersFileDataAction, nameImportTypeOrders;
;

DESIGN integrationData {
    pane {
        actionsContainer {
            MOVE PROPERTY(importProductionOrdersDataAction());
            MOVE PROPERTY(importProductionOrdersFileDataAction());
            MOVE PROPERTY(nameImportTypeOrders());            
        }
    }
}

EXTEND FORM Production.order
PROPERTIES(o) nameImportTypeOrder
PROPERTIES(o) importProductionOrderDataAction TODRAW pd TOOLBAR
;

DESIGN Production.order{
    specification.box {
        NEW headerImportContainer {
            caption = 'Импорт';
            MOVE PROPERTY(nameImportTypeOrder(o));
            MOVE PROPERTY(importProductionOrderDataAction(o));
        }
    }
}

CONSTRAINT importTypeOrder(order) AND  (Production.operationOrder(order) != autoImportOperationImportType(importTypeOrder(order)))
   CHECKED BY importTypeOrder MESSAGE 'У заказа и типа импорта не совпадают операции';  