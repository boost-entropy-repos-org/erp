MODULE ImportEmailOrder;

REQUIRE System, Email, PurchaseOrder, PurchaseOrderStatus;

importEmailOrderAction 'Загрузить параметры заказов из почты' = ACTION CUSTOM 'lsfusion.erp.integration.universal.emailorder.ImportEmailOrderActionProperty' ();

importEmailOrderAccount 'E-mail аккаунт' =  DATA Email.Account();
importEmailOrderNameAccount 'E-mail аккаунт' () = nameAccount(importEmailOrderAccount());
importEmailOrderFirstRow 'Начинать со строки' =  DATA INTEGER();
importEmailOrderNumberCell 'Ячейка номера инвойса' =  DATA VARSTRING[10]();
importEmailOrderQuantityColumn 'Колонка количества' =  DATA VARSTRING[10]();

orderSeriesNumber (seriesNumber) = GROUP AGGR order BY Purchase.seriesNumberOrder(order); 
orderDetailIndexNumberOrder (index, numberOrder) = GROUP AGGR orderDetail 
    BY Purchase.indexOrderDetail(orderDetail), Purchase.seriesNumberOrder(Purchase.orderOrderDetail(orderDetail));

importedOrderAttachmentEmail 'Заказ импортирован' = DATA BOOLEAN (AttachmentEmail);  
notImportedOrderAttachmentEmail (attachmentEmail) = NOT importedOrderAttachmentEmail (attachmentEmail);

EXTEND FORM mail PROPERTIES(ae) importedOrderAttachmentEmail BEFORE importedAttachmentEmail(ae);

EXTEND FORM integrationData
    PROPERTIES() importEmailOrderAction, importEmailOrderNameAccount, importEmailOrderFirstRow, importEmailOrderNumberCell,
                 importEmailOrderQuantityColumn    
;
DESIGN integrationData {
    pane {
        NEW emailorder {
            caption = 'Импорт заказов из почты';
            MOVE PROPERTY(importEmailOrderAction());
            MOVE PROPERTY(importEmailOrderNameAccount());
            MOVE PROPERTY(importEmailOrderFirstRow());
            MOVE PROPERTY(importEmailOrderNumberCell());
            MOVE PROPERTY(importEmailOrderQuantityColumn());
        }
    }
}