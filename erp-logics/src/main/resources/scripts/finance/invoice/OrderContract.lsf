MODULE OrderContract;

REQUIRE StockContract, Order;

META defineOrderPaymentCondition (sign)

    paymentCondition 'Условия оплаты' = ABSTRACT PaymentCondition (Order) PERSISTENT;
    paymentCondition 'Условия оплаты' = DATA PaymentCondition (UserOrder);
    paymentCondition(UserOrder prop) += paymentCondition(prop);
    paymentCondition[Order.Order](Order prop) += paymentCondition(prop);
    descriptionPaymentCondition 'Условия оплаты' (Order i) = description(paymentCondition(i)) IN base MINCHARWIDTH 10 PREFCHARWIDTH 15;
    descriptionPaymentCondition 'Условия оплаты' (UserOrder i) = description(paymentCondition(i)) MINCHARWIDTH 10 PREFCHARWIDTH 15;

    paymentCondition(UserOrder prop) <- OVERRIDE paymentCondition(agreement(prop)), paymentCondition(contractSku(prop))
        WHEN CHANGED(agreement(prop)) OR
             CHANGED(contractSku(prop));

    EXTEND FORM userOrder
        PROPERTIES(o) descriptionPaymentCondition
    ;

    DESIGN userOrder{
        o.documentPrm{
            MOVE PROPERTY(descriptionPaymentCondition(o));
        }
    }

END

paymentCondition 'Условие оплаты' = ABSTRACT PaymentCondition (Order) PERSISTENT;
descriptionPaymentCondition 'Условие оплаты' (Order o) = description(paymentCondition(o)) IN base MINCHARWIDTH 10 PREFCHARWIDTH 15;
