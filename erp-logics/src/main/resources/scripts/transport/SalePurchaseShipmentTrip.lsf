MODULE SalePurchaseShipmentTrip;

REQUIRE SalePurchaseInvoiceShipment, PurchaseSaleReturnInvoiceShipment, Trip;

isTransitShipment 'В пути' = ABSTRACT BOOLEAN (Shipment.Shipment) PERSISTENT;
quantityShippedShipment 'Поставлено (кол-во)' = ABSTRACT NUMERIC[14,3] (Shipment.Shipment) PERSISTENT;

////-- Расчет документов, которые в пути

//// продажа
isTransitShipment(s) += isTransitSaleShipment(s);
quantityShippedShipment(s) +=  NUMERIC[14,3](quantityShippedSaleShipment(s));

////-- возврат поставщику
isTransitShipment(s) += isTransitPurchaseReturnShipment(s);
quantityShippedShipment(s) += NUMERIC[14,3](quantityShippedPurchaseReturnShipment(s));

FORM transitOrder 'Поставки в пути'
    
    OBJECTS s = Shipment.Shipment
    PROPERTIES (s) READONLY Shipment.isPostedShipment, Shipment.numberShipment, Shipment.seriesShipment, Shipment.dateShipment, Shipment.timeShipment
    PROPERTIES (s) READONLY Shipment.nameSupplierShipment, Shipment.nameSupplierStockShipment, Shipment.nameCustomerShipment,
                   Shipment.nameCustomerStockShipment
    PROPERTIES (s) READONLY Shipment.countShipmentDetailShipment, Shipment.quantityShipmentDetailShipment, Shipment.sumShipmentDetailShipment
    PROPERTIES (s) READONLY Shipment.noteShipment, quantityShippedShipment, objectClassName
    FILTERS isTransitShipment(s)
;

NAVIGATOR {
    transportNavigator {
        NEW transportReportss 'Отчет' {
            ADD transitOrder;
        }
    }
}