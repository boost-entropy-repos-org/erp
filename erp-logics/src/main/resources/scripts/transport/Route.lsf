MODULE Route;

REQUIRE Transport, Numerator;

// ------------------------------- Route ----------------------------------- //
CLASS Route 'Маршрут' : NumeratedObject;
TABLE route(Route);

@defineNumberedObject(Route);
@defineNumeratedObjectDefault(Route, 'Нумератор для маршрутов', 'МР');

truckRoute = DATA Truck(Route);
sidTruckRoute 'Машина' (route) = sidTruck(truckRoute(route));

FORM route 'Маршрут'
    OBJECTS r=Route FIXED PANEL
    PROPERTIES(r) nameNumeratorRoute, numberRoute, seriesRoute, sidTruckRoute

    EDIT Route OBJECT r
;

FORM routes 'Маршруты'
    OBJECTS r=Route
    PROPERTIES(r) READONLY nameNumeratorRoute, numberRoute, seriesRoute, sidTruckRoute
    PROPERTIES(r) ADDFORM, EDITFORM, DELETE FORCE PANEL TOOLBAR
;


// ------------------------------- Node ------------------------------------ //
CLASS ABSTRACT Node 'Пункт';

nameNode 'Наименование' = ABSTRACT VARISTRING[150](Node);
addressNode 'Адрес' = ABSTRACT VARISTRING[100](Node);
legalEntityNode = ABSTRACT LegalEntity(Node);

nameLegalEntityNode 'Юр. лицо' (node) = nameLegalEntity(legalEntityNode(node));

TABLE nodeRoute(Node, Route);
inNodeRoute 'Вкючен' = DATA BOOLEAN(Node, Route);
numberNodeRoute 'Порядковый номер' = DATA INTEGER(Node, Route);

EXTEND CLASS Stock : Node;
//EXTEND CLASS supplier : node;

nameNode(stock) += nameStock(stock) IF stock IS Stock;

addressNode(stock) += addressStock(stock) IF stock IS Stock;

legalEntityNode(stock) += legalEntityStock(stock);


//nameNode(supplier) += name(supplier) IF supplier IS Supplier;

EXTEND FORM route

    OBJECTS n=Node
    PROPERTIES (n) READONLY nameNode, addressNode
    PROPERTIES (n, r) inNodeRoute, numberNodeRoute
;

EXTEND FORM routes
    OBJECTS n=Node
    PROPERTIES (n) READONLY nameNode, addressNode
    PROPERTIES(n, r) READONLY numberNodeRoute
    FILTERS inNodeRoute(n, r)
;

NAVIGATOR {
    transportDocuments {
        ADD routes;
    }
}