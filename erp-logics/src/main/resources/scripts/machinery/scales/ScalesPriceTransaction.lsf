MODULE ScalesPriceTransaction;

REQUIRE Scales, MachineryPriceTransaction;

NAMESPACE Scales;
// ----------------------------------------- Загрузка в ВУ -------------------------------------- //

CLASS ScalesPriceTransaction 'Загрузка прайса в весы' : MachineryPriceTransaction;
groupScales 'Группа весов' = DATA GroupScales (ScalesPriceTransaction);
groupMachinery (ScalesPriceTransaction transaction) += groupScales(transaction);

EXTEND FORM groupMachineryInput
    PROPERTIES(m) READONLY SHOWIF is(g)       number
;

createMachineryPriceTransaction (GroupScales groupMachinery) += ACTION {
    IF groupMachinery IS GroupScales THEN
        FOR NEW o = ScalesPriceTransaction DO
            addedTransaction() <- o;
}

skip(GroupScales groupMachinery, Barcode barcode) += WHEN groupMachinery IS GroupScales AND charLength(id(barcode)) != 5 THEN TRUE;

skipSnapshot(ScalesPriceTransaction t) += groupScales(t) AND skipSnapshotMachinery(mainRole(currentUser()));

skipLastTransaction(GroupScales g) += g IS GroupScales;