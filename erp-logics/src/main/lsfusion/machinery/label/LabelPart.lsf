MODULE LabelPart;

REQUIRE Label, ItemPart;

NAMESPACE Label;

partPrice = DATA LOCAL NUMERIC[16,4] (Sku);

overCreateLabelTransaction(LabelTransaction t) + {
    LOCAL sendSet = BOOLEAN (Sku);
    sendSet (Sku s) <- TRUE WHERE GROUP SUM 1 IF inLabel(item(Part p)) AND active(set(p)) AND set(p) = s;
    
    inLabel(Sku s) <- TRUE WHERE sendSet(s);
    
    FOR PriceListType pt == overPriceListType(t) NOINLINE DO
        partPrice(Sku s) <- (GROUP SUM prevPriceA(pt, item(Part p), departmentStore(t), dateTime(t)) IF set(p) = s) WHERE sendSet(s);

    inLabel(Sku s) <- NULL WHERE GROUP SUM 1 IF sendSet(set(Part p)) AND skip(p) AND item(p) = s;
}

createAttribute(LabelTransactionDetail d) + {
    documentPrice(d) <- partPrice(sku(d)) WHERE partPrice(sku(d));     
}