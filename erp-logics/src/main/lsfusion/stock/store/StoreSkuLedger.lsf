MODULE StoreSkuLedger;

REQUIRE Store, SkuLedger;

NAMESPACE Store;

explicitBatchLedger 'Партионный учет' = DATA BOOLEAN (DepartmentStore);
explicitBatchLedger(DepartmentStore stock) += explicitBatchLedger(stock);

dataPriceBatchLedger 'Использовать свои цены для каждой партии' = DATA BOOLEAN (DepartmentStore);
dataPriceBatchLedger(DepartmentStore stock) += dataPriceBatchLedger(stock);

EXTEND FORM departmentStore
    PROPERTIES(d) explicitBatchLedger SHOWIF isCompany(d), dataPriceBatchLedger SHOWIF showPriceBatchLedger(d) 
;

DESIGN departmentStore {
    headerExtraParams {
        MOVE PROPERTY(explicitBatchLedger(d));
        MOVE PROPERTY(dataPriceBatchLedger(d));
    }
}

balanceA 'Остаток' (sku, store, dateTime) =
    GROUP
    BY Sku sku, store(DepartmentStore stock), DATETIME dateTime SUM balanceA(sku, stock, dateTime);
balanceA 'Остаток' (sku, store, date) =
    GROUP
    BY Sku sku, store(DepartmentStore stock), DATE date SUM balanceA(sku, stock, date);
        
balanceB 'Остаток' (sku, store, dateTime) = 
    GROUP 
    BY Sku sku, store(DepartmentStore stock), DATETIME dateTime SUM balanceB(sku, stock, dateTime);
balanceB 'Остаток' (sku, store, date) = 
    GROUP 
    BY Sku sku, store(DepartmentStore stock), DATE date SUM balanceB(sku, stock, date);