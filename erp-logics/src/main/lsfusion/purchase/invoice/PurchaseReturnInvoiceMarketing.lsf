MODULE PurchaseReturnInvoiceMarketing;

REQUIRE PurchaseInvoiceMarketing, PurchaseReturnInvoice;

NAMESPACE PurchaseReturn;

percMarketingSupplier '% маркетинга' = ABSTRACT NUMERIC[8,4] (PurchaseReturn.InvoiceDetail);
percMarketingSupplier '% маркетинга' = DATA NUMERIC[8,4] (PurchaseReturn.UserInvoiceDetail);
percMarketingSupplier(PurchaseReturn.UserInvoiceDetail d) += percMarketingSupplier(d);
Invoice.percMarketingSupplier(PurchaseReturn.InvoiceDetail d) += percMarketingSupplier(d);

showMarketingSupplier = showMarketingSupplier(operation(PurchaseReturn.Invoice i));

EXTEND FORM PurchaseReturn.userInvoice
    PROPERTIES (d) percMarketingSupplier SHOWIF showMarketingSupplier(i)
;
EXTEND FORM PurchaseReturn.invoices
    PROPERTIES (d) READONLY percMarketingSupplier SHOWIF showMarketingSupplier(i)
;
marketingSum 'Сумма маркетинга'  (InvoiceDetail d) = round2(sum(d)*percMarketingSupplier(d)/100.0); 
marketingSumInvoiceDetail 'Сумма маркетинга'  = GROUP BY invoice(InvoiceDetail d) SUM marketingSum(d); 