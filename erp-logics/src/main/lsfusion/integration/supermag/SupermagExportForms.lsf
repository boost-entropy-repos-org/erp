MODULE SupermagExportForms;

REQUIRE SupermagSettings;

CLASS DocMain;
CLASS DocDetail;
CLASS SMActs;

inc = DATA LOCAL BOOLEAN (DocMain);
id  = DATA LOCAL STRING[100] (DocMain);
docid = DATA LOCAL STRING[50] (DocMain);
doctype = DATA LOCAL STRING[10] (DocMain);
bornin = DATA STRING[100] (DocMain);
opcode = DATA LOCAL STRING[10] (DocMain);
userop = DATA LOCAL STRING[10] (DocMain);
docstate = DATA LOCAL INTEGER (DocMain);
creatdate = DATA LOCAL DATETIME (DocMain);
posteddate =  DATA LOCAL DATETIME (DocMain);
opname =  DATA LOCAL STRING[100] (DocMain);
clientIndex = DATA LOCAL STRING[100] (DocMain);
location = DATA STRING[100] (DocMain);
locationFrom = DATA STRING[100] (DocMain);
locationTo = DATA STRING[100] (DocMain);
invoiceDocNumber = DATA LOCAL STRING[100] (DocMain);
overInvoiceDocSum = ABSTRACT NUMERIC[18,4] (DocMain);
invoiceDocSum = DATA LOCAL NUMERIC[18,4] (DocMain);
invoiceDocCreate = DATA DATETIME (DocMain);
execTime = DATA LOCAL DATETIME (DocMain);
execDate = DATA LOCAL DATETIME (DocMain);
priceType = DATA LOCAL STRING[10] (DocMain);
reasonPricing = DATA LOCAL STRING[100] (DocMain);
note = DATA LOCAL ISTRING[500] (DocMain);
sumNoTax = DATA LOCAL NUMERIC[18,4] (DocMain);
sumWithTax = DATA LOCAL NUMERIC[18,4] (DocMain);
sumCurr = DATA LOCAL NUMERIC[18,4] (DocMain);
createFinobligation = DATA LOCAL BOOLEAN (DocMain);
curRate(DocMain doc) = (OVERRIDE rateOn(typeExchange('НБРБ (BYR)'),currencyShortName('USD'),DATE (creatdate(doc))),(1.0 IF doc IS DocMain));
countSpec = DATA LOCAL INTEGER (DocMain);       
acceptsum = DATA LOCAL NUMERIC[18,4] (DocMain);
basesum = DATA LOCAL NUMERIC[18,4] (DocMain);
calcenddate = DATA LOCAL DATETIME (DocMain);
paymentdelay = DATA LOCAL INTEGER (DocMain);
finagent = DATA LOCAL STRING[100] (DocMain);
iscalendardelay = DATA LOCAL STRING[1] (DocMain);
ourselfclient = DATA LOCAL STRING[100] (DocMain);
blanknumber = DATA LOCAL STRING[100] (DocMain);
blankdate = DATA LOCAL DATETIME (DocMain);
orderdate = DATA LOCAL DATETIME (DocMain);
supplydate = DATA LOCAL DATETIME (DocMain);
supplytime = DATA LOCAL INTEGER (DocMain);
deliverydate = DATA LOCAL DATETIME (DocMain);
deliverytime = DATA LOCAL TIME (DocMain);
useForAutoGen = DATA LOCAL STRING[1] (DocMain);
sumPositivePayments = DATA LOCAL NUMERIC[18,4] (DocMain, INTEGER);
sumNegativePayments = DATA LOCAL NUMERIC[18,4] (DocMain, INTEGER);
startdate = DATA LOCAL DATETIME (DocMain);
enddate = DATA LOCAL DATETIME (DocMain);
orderno = DATA LOCAL STRING[50] (DocMain);

docMain = DATA DocMain (DocDetail) NONULL DELETE;
id = DATA LOCAL STRING[50] (DocDetail);
docid(DocDetail det) = docid(docMain(det));
doctype(DocDetail det) = doctype(docMain(det));
index = DATA LOCAL INTEGER (DocDetail);
indexPlus = DATA LOCAL INTEGER (DocDetail);
indexMinus = DATA LOCAL INTEGER (DocDetail);
skuId = DATA LOCAL STRING[100] (DocDetail);
quantity = DATA LOCAL NUMERIC[16,5] (DocDetail);
blankquantity = DATA LOCAL NUMERIC[16,5] (DocDetail);
priceRoundMode = DATA LOCAL INTEGER (DocMain);
priceWithTax = DATA LOCAL NUMERIC[18,4] (DocDetail);
priceCurr = DATA LOCAL NUMERIC[18,4] (DocDetail);    
priceNoTax = DATA LOCAL NUMERIC[18,4] (DocDetail);
priceManufacturer = DATA LOCAL NUMERIC[18,4] (DocDetail);
extracharge =  DATA LOCAL NUMERIC[18,4] (DocDetail);
priceRetail = DATA LOCAL NUMERIC[18,4] (DocDetail);
valueTax = DATA LOCAL NUMERIC[10,5] (DocDetail);
sumTax = DATA LOCAL NUMERIC[18,4] (DocDetail);
sumNoTax = DATA LOCAL NUMERIC[18,4] (DocDetail);
sumWithTax = DATA LOCAL NUMERIC[18,4] (DocDetail);
sumCurr = DATA LOCAL NUMERIC[18,4] (DocDetail);
expiryDate = DATA LOCAL DATE (DocDetail);
oldPrice = DATA LOCAL NUMERIC[18,4] (DocDetail);
flags = DATA LOCAL STRING[10] (DocDetail);
revalSum =DATA LOCAL NUMERIC[18,4] (DocDetail);
revalOperQuantity = DATA LOCAL NUMERIC[18,5] (DocDetail); 
curRate(DocDetail det) = GROUP SUM curRate(DocMain doc) IF doc = docMain(det);
causeType = DATA LOCAL STRING[10] (DocDetail);
causeId = DATA LOCAL STRING (DocDetail);
causeSpecItem = DATA LOCAL STRING[10] (DocDetail);
discSum = DATA LOCAL NUMERIC[18,4] (DocDetail);
moveType = DATA LOCAL INTEGER (DocDetail);
awaitquantity = DATA LOCAL NUMERIC[14,3] (DocDetail);
awaittotalprice = DATA LOCAL NUMERIC[19,4] (DocDetail);
awaittotalpricecur = DATA LOCAL NUMERIC[19,4] (DocDetail);
actualquantity = DATA LOCAL NUMERIC[14,3] (DocDetail);

CLASS DocBase;
docid = DATA LOCAL STRING[50] (DocBase);
doctype = DATA LOCAL STRING[10] (DocBase);
basisDoc 'Документы основания' = DATA LOCAL BOOLEAN (DocMain, DocBase);      
  
CLASS DocProp;
docMain = DATA LOCAL DocMain (DocProp);
paramname = DATA LOCAL STRING[50] (DocProp);
paramvalue = DATA LOCAL STRING[100] (DocProp);
     
CLASS DocPayment;
docMain = DATA LOCAL DocMain (DocPayment);
credcardId = DATA LOCAL INTEGER (DocPayment);
sum = DATA LOCAL NUMERIC[18,4] (DocPayment);
     
       //различные индексы сделаны для SPECITEM т.к. из одного документа с + и - мы делаем 2 в супермаге
//indexPlus (DocDetail ad) = PARTITION SUM 1 IF quantity(ad)>0 ORDER ad BY SMDocuments(ad) CHARWIDTH 4;
//indexMinus (DocDetail ad) = PARTITION SUM 1 IF quantity(ad)<0 ORDER ad BY SMDocuments(ad) CHARWIDTH 4;

GROUP WI;
GROUP WI_SMDOCUMENTS EXTID 'SMDOCUMENTS': WI;
GROUP WI_SMCOMMONBASES EXTID 'SMCOMMONBASES': WI;
GROUP WI_SMSPEC EXTID 'SMSPEC': WI;
GROUP WI_SMWAYBILLSIN EXTID 'SMWAYBILLSIN' : WI;
GROUP WI_SMSPECIO EXTID 'SMWSPECIO' : WI;
FORM exportWI FORMEXTID 'PACKAGE' 
    PROPERTIES ATTR = exportTime(currentDateTime())  EXTID 'name'            

    OBJECTS doc = DocMain EXTID 'POSTOBJECT'
    PROPERTIES ATTR = 'normal' IF doc IS DocMain EXTID 'action'      
    PROPERTIES ATTR = 'Приходная накладная' IF doc IS DocMain EXTID 'description'  
    
    PROPERTIES = STRING[100](id(doc)) EXTID 'Id'
    PROPERTIES = doctype(doc) EXTID 'DOCTYPE' IN WI_SMDOCUMENTS
    PROPERTIES = STRING[100](docid(doc)) EXTID 'ID' IN WI_SMDOCUMENTS
    PROPERTIES = bornin(doc) EXTID 'BORNIN' IN WI_SMDOCUMENTS    
    PROPERTIES = exportTime(creatdate(doc))  EXTID 'CREATEDAT' IN WI_SMDOCUMENTS    
    PROPERTIES = docstate(doc) EXTID 'DOCSTATE' IN WI_SMDOCUMENTS           
    PROPERTIES = opcode(doc) EXTID 'OPCODE' IN WI_SMDOCUMENTS
    PROPERTIES = userop(doc) EXTID 'USEROP' IN WI_SMDOCUMENTS        
    PROPERTIES = clientIndex(doc) EXTID 'CLIENTINDEX' IN WI_SMDOCUMENTS        
    PROPERTIES = locationTo(doc) EXTID 'LOCATIONTO' IN WI_SMDOCUMENTS   
    PROPERTIES = 1 IF doc IS DocMain EXTID 'CURRENCYTYPE' IN WI_SMDOCUMENTS        
    PROPERTIES = curRate(doc) EXTID 'CURRENCYRATE' IN WI_SMDOCUMENTS 
    PROPERTIES = 0 IF doc IS DocMain EXTID 'CURRENCYMULTORDER' IN WI_SMDOCUMENTS      
    PROPERTIES = OVERRIDE sumWithTax(doc), 0 EXTID 'TOTALSUM' IN WI_SMDOCUMENTS    
    PROPERTIES = OVERRIDE sumCurr(doc), 0 EXTID 'TOTALSUMCUR' IN WI_SMDOCUMENTS    
    PROPERTIES = OVERRIDE priceRoundMode(doc), 0 EXTID 'PRICEROUNDMODE' IN WI_SMDOCUMENTS       
    PROPERTIES = 1 IF doc IS DocMain  EXTID 'ISROUBLES' IN WI_SMDOCUMENTS      
    PROPERTIES = note(doc)  EXTID 'COMMENTARY' IN WI_SMDOCUMENTS     
                                                               
    FILTERS inc(doc)                                                      

    OBJECTS docd = DocDetail EXTID 'SMSPEC' IN WI 
    PROPERTIES = docid(docd) EXTID 'DOCID'    
    PROPERTIES = doctype(docd) EXTID 'DOCTYPE'      
    PROPERTIES = index(docd) EXTID 'SPECITEM'
    PROPERTIES d1 = index(docd) EXTID 'DISPLAYITEM'
    PROPERTIES = skuId(docd) EXTID 'ARTICLE'                          
    PROPERTIES = OVERRIDE abs(quantity(docd)), 0 EXTID 'QUANTITY'
    PROPERTIES = OVERRIDE priceWithTax(docd), 0 EXTID 'ITEMPRICE'     
    PROPERTIES = OVERRIDE sumWithTax(docd), 0 EXTID 'TOTALPRICE'  
    PROPERTIES = OVERRIDE priceNoTax(docd), 0 EXTID 'ITEMPRICENOTAX'  
    PROPERTIES = OVERRIDE sumNoTax(docd), 0 EXTID 'TOTALPRICENOTAX'            
    PROPERTIES = OVERRIDE priceCurr(docd), 0 EXTID 'ITEMPRICECUR'                         
    PROPERTIES = OVERRIDE sumCurr(docd), 0 EXTID 'TOTALPRICECUR'      
    PROPERTIES = causeType(docd) EXTID 'CAUSETYPE'            
    PROPERTIES = causeId(docd) EXTID 'CAUSEID'                         
    PROPERTIES = causeSpecItem(docd) EXTID 'CAUSESPECITEM'      
    FILTERS docMain(docd)==doc

    PROPERTIES = STRING[100](docid(doc)) EXTID 'ID' IN WI_SMWAYBILLSIN      
    PROPERTIES = STRING[50](doctype(doc)) EXTID 'DOCTYPE' IN WI_SMWAYBILLSIN 
    PROPERTIES = 0 IF doc IS DocMain EXTID 'GOODSOWNER' IN WI_SMWAYBILLSIN                        
    PROPERTIES = ourselfclient(doc) EXTID 'OURSELFCLIENT' IN WI_SMWAYBILLSIN    
    PROPERTIES = 0 IF doc IS DocMain EXTID 'PAYCASH' IN WI_SMWAYBILLSIN      
    PROPERTIES = invoiceDocNumber(doc) EXTID 'SUPPLIERDOC' IN WI_SMWAYBILLSIN      
    PROPERTIES = exportTime(invoiceDocCreate(doc)) EXTID 'SUPPLIERDOCCREATE' IN WI_SMWAYBILLSIN      
    PROPERTIES = invoiceDocSum(doc) EXTID 'SUPPLDOCSUM' IN WI_SMWAYBILLSIN      
          
    OBJECTS docd2 = DocDetail EXTID 'SMSPECIO' IN WI 
    PROPERTIES = docid(docd2) EXTID 'DOCID'   
    PROPERTIES = STRING[10](doctype(docd2)) EXTID 'DOCTYPE'     
    PROPERTIES = index(docd2) EXTID 'SPECITEM'
    FILTERS docMain(docd2)==doc    
    
    OBJECTS docd3 = DocDetail EXTID 'SMSPECTAX' IN WI
    PROPERTIES = docid(docd3) EXTID 'DOCID'    
    PROPERTIES = doctype(docd3) EXTID 'DOCTYPE'      
    PROPERTIES = index(docd3) EXTID 'SPECITEM'
    PROPERTIES = 0 IF docd3 IS DocDetail  EXTID 'TAXID'        
    PROPERTIES = OVERRIDE valueTax(docd3), 0 EXTID 'TAXRATE'
    PROPERTIES = OVERRIDE sumTax(docd3), 0 EXTID 'TAXSUM'            
    FILTERS docMain(docd3)==doc   

    OBJECTS docd4 = DocDetail EXTID 'SMSPECBY' IN WI
    PROPERTIES = docid(docd4) EXTID 'DOCID'    
    PROPERTIES = doctype(docd4) EXTID 'DOCTYPE'      
    PROPERTIES = index(docd4) EXTID 'SPECITEM'
    PROPERTIES = extracharge(docd4) EXTID 'EXTRACHARGE'  
    PROPERTIES = priceManufacturer(docd4) EXTID 'MANUFACTURERSPRICE'     
    PROPERTIES = priceRetail(docd4) EXTID 'RETAILPRICE'       
    PROPERTIES = 0 IF docd4 IS DocDetail EXTID 'STATEREGULATION'                           
    FILTERS docMain(docd4)==doc  
    
    OBJECTS docd5 = DocDetail EXTID 'SLSPECPACKS' IN WI
    PROPERTIES = docid(docd5) EXTID 'DOCID'    
    PROPERTIES = doctype(docd5) EXTID 'DOCTYPE'      
    PROPERTIES = index(docd5) EXTID 'SPECITEM'
    PROPERTIES = -1 IF docd5 IS DocDetail EXTID 'PACKNUM'        
    PROPERTIES = 0 IF docd5 IS DocDetail EXTID 'NPACKS'       
    PROPERTIES = 0 IF docd5 IS DocDetail EXTID 'PACKSIZE'     
    PROPERTIES = exportTime(toDateTime[DATE](expiryDate(docd5))) EXTID 'VALIDDATE'                
    FILTERS docMain(docd5)==doc
    
    OBJECTS docd6 = DocDetail EXTID 'SLSPECQMISMATCH' IN WI
    PROPERTIES = docid(docd6) EXTID 'DOCID'    
    PROPERTIES = doctype(docd6) EXTID 'DOCTYPE'      
    PROPERTIES = index(docd6) EXTID 'SPECITEM'
    PROPERTIES = blankquantity(docd6) EXTID 'QUANTBYDOC'                  
    FILTERS docMain(docd6)==doc     
                  
    OBJECTS b = DocBase EXTID 'SMCOMMONBASES' IN WI 
    PROPERTIES = STRING[100](docid(doc)) IF b IS DocBase EXTID 'ID'  
    PROPERTIES = STRING[10](doctype(doc)) IF b IS DocBase EXTID 'DOCTYPE'     
    PROPERTIES = doctype(b) EXTID 'BASEDOCTYPE'                    
    PROPERTIES = docid(b) EXTID 'BASEID'    
    FILTERS basisDoc(doc, b)        

    OBJECTS p = DocProp EXTID 'SMDOCPROPS' IN WI 
    PROPERTIES = STRING[100](docid(doc)) IF p IS DocProp EXTID 'DOCID'  
    PROPERTIES = STRING[10](doctype(doc)) IF p IS DocProp EXTID 'DOCTYPE'     
    PROPERTIES = paramname(p) EXTID 'PARAMNAME'                    
    PROPERTIES = paramvalue(p) EXTID 'PARAMVALUE'    
    FILTERS docMain(p) = doc AND paramvalue(p)                             
; 

GROUP FI;
GROUP FI_SMFINOBLIGATION EXTID 'SMFINOBLIGATION' : FI;
FORM exportFI FORMEXTID 'PACKAGE' 
    PROPERTIES ATTR = exportTime(currentDateTime())  EXTID 'name'
    
    OBJECTS doc = DocMain EXTID 'POSTOBJECT'
    PROPERTIES ATTR = 'Финансовое обязательство по поставке' IF doc IS DocMain EXTID 'description'  
    PROPERTIES ATTR = 'normal' IF doc IS DocMain EXTID 'action'  
    PROPERTIES = STRING[100]('FI'+docid(doc)+'\t'+doctype(doc)) EXTID 'Id'
    PROPERTIES = docid(doc) EXTID 'DOCID' IN FI_SMFINOBLIGATION   
    PROPERTIES = doctype(doc) EXTID 'DOCTYPE' IN FI_SMFINOBLIGATION    
    PROPERTIES = acceptsum(doc) EXTID 'ACCEPTSUM' IN FI_SMFINOBLIGATION   
    PROPERTIES = basesum(doc) EXTID 'BASESUM' IN FI_SMFINOBLIGATION   
    PROPERTIES = exportTime(creatdate(doc)) EXTID 'BEGINDATE' IN FI_SMFINOBLIGATION   
    PROPERTIES = bornin(doc) EXTID 'BORNIN' IN FI_SMFINOBLIGATION       
    PROPERTIES = exportTime(calcenddate(doc)) EXTID 'CALCENDDATE' IN FI_SMFINOBLIGATION   
    PROPERTIES = clientIndex(doc) EXTID 'CLIENTINDEX' IN FI_SMFINOBLIGATION  
    PROPERTIES = finagent(doc) EXTID 'FINAGENT' IN FI_SMFINOBLIGATION      
    PROPERTIES = 0 IF doc IS DocMain  EXTID 'FINEPERCENT' IN FI_SMFINOBLIGATION  
    PROPERTIES = 0 IF doc IS DocMain  EXTID 'ISADMITTED' IN FI_SMFINOBLIGATION 
    PROPERTIES = iscalendardelay(doc) EXTID 'ISCALENDARDELAY' IN FI_SMFINOBLIGATION     
    PROPERTIES = ourselfclient(doc)  EXTID 'OURSELFCLIENT' IN FI_SMFINOBLIGATION 
    PROPERTIES = (OVERRIDE paymentdelay(doc), 0)  EXTID 'PAYMENTDELAY' IN FI_SMFINOBLIGATION              
    PROPERTIES = 1 IF doc IS DocMain  EXTID 'PAYMENTPRTY' IN FI_SMFINOBLIGATION          
    FILTERS inc(doc), createFinobligation(doc)           
;

GROUP WO;
GROUP WO_SMDOCUMENTS EXTID 'SMDOCUMENTS': WO;
GROUP WO_SMCOMMONBASES EXTID 'SMCOMMONBASES': WO;
GROUP WO_SMSPEC EXTID 'SMSPEC': WO;
GROUP WO_SMWAYBILLSOUT EXTID 'SMWAYBILLSOUT' : WO;
GROUP WO_SMSPECIO EXTID 'SMWSPECIO' : WO;

FORM exportWO FORMEXTID 'PACKAGE' 
    PROPERTIES ATTR = exportTime(currentDateTime())  EXTID 'name'

    OBJECTS doc = DocMain EXTID 'POSTOBJECT'
    PROPERTIES ATTR = 'normal' IF doc IS DocMain EXTID 'action'      
    PROPERTIES ATTR = 'Расходная накладная' EXTID 'description'      
    PROPERTIES = STRING[100](id(doc)) EXTID 'Id'
    PROPERTIES = doctype(doc) EXTID 'DOCTYPE' IN WO_SMDOCUMENTS
    PROPERTIES = STRING[100](docid(doc)) EXTID 'ID' IN WO_SMDOCUMENTS
    PROPERTIES = bornin(doc) EXTID 'BORNIN' IN WO_SMDOCUMENTS    
    PROPERTIES = exportTime(creatdate(doc))  EXTID 'CREATEDAT' IN WO_SMDOCUMENTS    
    PROPERTIES = docstate(doc) EXTID 'DOCSTATE' IN WO_SMDOCUMENTS           
    PROPERTIES = opcode(doc) EXTID 'OPCODE' IN WO_SMDOCUMENTS
    PROPERTIES = userop(doc) EXTID 'USEROP' IN WO_SMDOCUMENTS        
    PROPERTIES = clientIndex(doc) EXTID 'CLIENTINDEX' IN WO_SMDOCUMENTS        
    PROPERTIES = locationFrom(doc) EXTID 'LOCATIONFROM' IN WO_SMDOCUMENTS
    PROPERTIES = 1 IF doc IS DocMain EXTID 'CURRENCYTYPE' IN WO_SMDOCUMENTS        
    PROPERTIES = curRate(doc) EXTID 'CURRENCYRATE' IN WO_SMDOCUMENTS 
    PROPERTIES = 0 IF doc IS DocMain EXTID 'CURRENCYMULTORDER' IN WO_SMDOCUMENTS      
    PROPERTIES = OVERRIDE sumWithTax(doc), 0 EXTID 'TOTALSUM' IN WO_SMDOCUMENTS    
    PROPERTIES = OVERRIDE sumCurr(doc), 0 EXTID 'TOTALSUMCUR' IN WO_SMDOCUMENTS    
    PROPERTIES = OVERRIDE priceRoundMode(doc), 0 EXTID 'PRICEROUNDMODE' IN WO_SMDOCUMENTS       
    PROPERTIES = 1 IF doc IS DocMain  EXTID 'ISROUBLES' IN WO_SMDOCUMENTS      
    PROPERTIES = note(doc) EXTID 'COMMENTARY' IN WO_SMDOCUMENTS     
    FILTERS inc(doc)              
                                                            
    OBJECTS docd = DocDetail EXTID 'SMSPEC' IN WO 
    PROPERTIES = docid(docd) EXTID 'DOCID'    
    PROPERTIES = doctype(docd) EXTID 'DOCTYPE'      
    PROPERTIES = index(docd) EXTID 'SPECITEM'
    PROPERTIES = skuId(docd) EXTID 'ARTICLE'                          
    PROPERTIES d1 = index(docd) EXTID 'DISPLAYITEM'
    PROPERTIES = OVERRIDE abs(quantity(docd)), 0 EXTID 'QUANTITY'
    PROPERTIES = OVERRIDE priceWithTax(docd), 0 EXTID 'ITEMPRICE'     
    PROPERTIES = OVERRIDE sumWithTax(docd), 0 EXTID 'TOTALPRICE'  
    PROPERTIES = OVERRIDE priceNoTax(docd), 0 EXTID 'ITEMPRICENOTAX'  
    PROPERTIES = OVERRIDE sumNoTax(docd), 0 EXTID 'TOTALPRICENOTAX'            
    PROPERTIES = OVERRIDE priceCurr(docd), 0 EXTID 'ITEMPRICECUR'                         
    PROPERTIES = OVERRIDE sumCurr(docd), 0 EXTID 'TOTALPRICECUR'      
    PROPERTIES = causeType(docd) EXTID 'CAUSETYPE'            
    PROPERTIES = causeId(docd) EXTID 'CAUSEID'                         
    PROPERTIES = causeSpecItem(docd) EXTID 'CAUSESPECITEM'      
    
    FILTERS docMain(docd)==doc
   
    PROPERTIES = STRING[100](docid(doc))  EXTID 'ID' IN WO_SMWAYBILLSOUT      
    PROPERTIES = STRING[100](doctype(doc)) EXTID 'DOCTYPE' IN WO_SMWAYBILLSOUT
    PROPERTIES = ourselfclient(doc) EXTID 'OURSELFCLIENT' IN WO_SMWAYBILLSOUT
    PROPERTIES = STRING[100](docid(doc))  EXTID 'INVOICE' IN WO_SMWAYBILLSOUT             
    PROPERTIES = 0 IF doc IS DocMain EXTID 'PAYCASH' IN WO_SMWAYBILLSOUT      
    PROPERTIES = invoiceDocNumber(doc) EXTID 'SUPPLIERDOC' IN WO_SMWAYBILLSOUT        
    PROPERTIES = exportTime(invoiceDocCreate(doc))  EXTID 'SUPPLIERDOCCREATE' IN WO_SMWAYBILLSOUT
    
    OBJECTS docd2 = DocDetail EXTID 'SMSPECIO' IN WO 
    PROPERTIES = docid(docd2) EXTID 'DOCID'   
    PROPERTIES = doctype(docd2) EXTID 'DOCTYPE'     
    PROPERTIES = index(docd2) EXTID 'SPECITEM'
    FILTERS docMain(docd2)==doc
        
    OBJECTS docd3 = DocDetail EXTID 'SMSPECTAX' IN WO
    PROPERTIES = docid(docd3) EXTID 'DOCID'    
    PROPERTIES = doctype(docd3) EXTID 'DOCTYPE'      
    PROPERTIES = index(docd3) EXTID 'SPECITEM'
    PROPERTIES = 0 IF docd3 IS DocDetail  EXTID 'TAXID'        
    PROPERTIES = OVERRIDE valueTax(docd3), 0 EXTID 'TAXRATE'
    PROPERTIES = OVERRIDE sumTax(docd3), 0 EXTID 'TAXSUM'            
    FILTERS docMain(docd3)==doc   

    OBJECTS docd4 = DocDetail EXTID 'SMSPECBY' IN WO
    PROPERTIES = docid(docd4) EXTID 'DOCID'    
    PROPERTIES = doctype(docd4) EXTID 'DOCTYPE'      
    PROPERTIES = index(docd4) EXTID 'SPECITEM'
    PROPERTIES = extracharge(docd4) EXTID 'EXTRACHARGE'  
    PROPERTIES = priceManufacturer(docd4) EXTID 'MANUFACTURERSPRICE'     
    PROPERTIES = priceRetail(docd4) EXTID 'RETAILPRICE'       
    PROPERTIES = 0 IF docd4 IS DocDetail EXTID 'STATEREGULATION'                           
    FILTERS docMain(docd4)==doc    
    
    OBJECTS docd5 = DocDetail EXTID 'SLSPECPACKS' IN WO
    PROPERTIES = docid(docd5) EXTID 'DOCID'    
    PROPERTIES = doctype(docd5) EXTID 'DOCTYPE'      
    PROPERTIES = index(docd5) EXTID 'SPECITEM'
    PROPERTIES = -1 IF docd5 IS DocDetail EXTID 'PACKNUM'        
    PROPERTIES = 0 IF docd5 IS DocDetail EXTID 'NPACKS'       
    PROPERTIES = 0 IF docd5 IS DocDetail EXTID 'PACKSIZE'     
    PROPERTIES = exportTime(toDateTime(expiryDate(docd5))) EXTID 'VALIDDATE'                
    FILTERS docMain(docd5)==doc    
    
    OBJECTS docd6 = DocDetail EXTID 'SLSPECQMISMATCH' IN WO
    PROPERTIES = docid(docd6) EXTID 'DOCID'    
    PROPERTIES = doctype(docd6) EXTID 'DOCTYPE'      
    PROPERTIES = index(docd6) EXTID 'SPECITEM'
    PROPERTIES = quantity(docd6) EXTID 'QUANTBYDOC'                  
    FILTERS docMain(docd6)==doc        
        
    OBJECTS b = DocBase EXTID 'SMCOMMONBASES' IN WO 
    PROPERTIES = STRING[100](docid(doc)) IF b IS DocBase EXTID 'ID'  
    PROPERTIES = STRING[10](doctype(doc)) IF b IS DocBase EXTID 'DOCTYPE'     
    PROPERTIES = doctype(b) EXTID 'BASEDOCTYPE'                    
    PROPERTIES = docid(b) EXTID 'BASEID'    
    FILTERS basisDoc(doc, b)      
    
    OBJECTS p = DocProp EXTID 'SMDOCPROPS' IN WO 
    PROPERTIES = STRING[100](docid(doc)) IF p IS DocProp EXTID 'DOCID'  
    PROPERTIES = STRING[10](doctype(doc)) IF p IS DocProp EXTID 'DOCTYPE'     
    PROPERTIES = paramname(p) EXTID 'PARAMNAME'                    
    PROPERTIES = paramvalue(p) EXTID 'PARAMVALUE'    
    FILTERS docMain(p) = doc  AND paramvalue(p)              
             
; 

GROUP IW;
GROUP IW_SMDOCUMENTS EXTID 'SMDOCUMENTS': IW;
GROUP IW_SMINTERNALWAYBILLS EXTID 'SMINTERNALWAYBILLS': IW; 
GROUP IW_SMCOMMONBASES EXTID 'SMCOMMONBASES': IW;
GROUP IW_SMSPEC EXTID 'SMSPEC': IW;

FORM exportIW FORMEXTID 'PACKAGE' 
    PROPERTIES ATTR = exportTime(currentDateTime())  EXTID 'name'

    OBJECTS doc = DocMain EXTID 'POSTOBJECT'
    PROPERTIES ATTR = 'normal' IF doc IS DocMain EXTID 'action'      
    PROPERTIES ATTR = opname(doc)  EXTID 'description'      
    PROPERTIES = STRING[100](id(doc)) EXTID 'Id'
    PROPERTIES = doctype(doc) EXTID 'DOCTYPE' IN IW_SMDOCUMENTS
    PROPERTIES = STRING[100](docid(doc)) EXTID 'ID' IN IW_SMDOCUMENTS
    PROPERTIES = bornin(doc) EXTID 'BORNIN' IN IW_SMDOCUMENTS    
    PROPERTIES = exportTime(creatdate(doc))  EXTID 'CREATEDAT' IN IW_SMDOCUMENTS    
    PROPERTIES = docstate(doc) EXTID 'DOCSTATE' IN IW_SMDOCUMENTS           
    PROPERTIES = opcode(doc) EXTID 'OPCODE' IN IW_SMDOCUMENTS
    PROPERTIES = userop(doc) EXTID 'USEROP' IN IW_SMDOCUMENTS        
    PROPERTIES = locationTo(doc) EXTID 'LOCATIONTO' IN IW_SMDOCUMENTS        
    PROPERTIES = locationFrom(doc) EXTID 'LOCATIONFROM' IN IW_SMDOCUMENTS
    PROPERTIES = 1 IF doc IS DocMain EXTID 'CURRENCYTYPE' IN IW_SMDOCUMENTS        
    PROPERTIES = curRate(doc) EXTID 'CURRENCYRATE' IN IW_SMDOCUMENTS 
    PROPERTIES = 0 IF doc IS DocMain EXTID 'CURRENCYMULTORDER' IN IW_SMDOCUMENTS      
    PROPERTIES = OVERRIDE sumWithTax(doc), 0 EXTID 'TOTALSUM' IN IW_SMDOCUMENTS    
    PROPERTIES = OVERRIDE sumCurr(doc), 0 EXTID 'TOTALSUMCUR' IN IW_SMDOCUMENTS    
    PROPERTIES = OVERRIDE priceRoundMode(doc), 0 EXTID 'PRICEROUNDMODE' IN IW_SMDOCUMENTS       
    PROPERTIES = 1 IF doc IS DocMain  EXTID 'ISROUBLES' IN IW_SMDOCUMENTS      
    PROPERTIES = note(doc) EXTID 'COMMENTARY' IN IW_SMDOCUMENTS     
    FILTERS inc(doc)                                          
             
    OBJECTS docd = DocDetail EXTID 'SMSPEC' IN IW 
    PROPERTIES = docid(docd) EXTID 'DOCID'    
    PROPERTIES = doctype(docd) EXTID 'DOCTYPE'      
    PROPERTIES = index(docd) EXTID 'SPECITEM'
    PROPERTIES = skuId(docd) EXTID 'ARTICLE'                          
    PROPERTIES d1 = index(docd) EXTID 'DISPLAYITEM'
    PROPERTIES = OVERRIDE abs(quantity(docd)), 0 EXTID 'QUANTITY'
    PROPERTIES = OVERRIDE priceWithTax(docd), 0 EXTID 'ITEMPRICE'     
    PROPERTIES = OVERRIDE sumWithTax(docd), 0 EXTID 'TOTALPRICE'  
    PROPERTIES = OVERRIDE priceNoTax(docd), 0 EXTID 'ITEMPRICENOTAX'  
    PROPERTIES = OVERRIDE sumNoTax(docd), 0 EXTID 'TOTALPRICENOTAX'            
    PROPERTIES = OVERRIDE priceCurr(docd), 0 EXTID 'ITEMPRICECUR'                         
    PROPERTIES = OVERRIDE sumCurr(docd), 0 EXTID 'TOTALPRICECUR'      
    PROPERTIES = causeType(docd) EXTID 'CAUSETYPE'            
    PROPERTIES = causeId(docd) EXTID 'CAUSEID'                         
    PROPERTIES = causeSpecItem(docd) EXTID 'CAUSESPECITEM'      
    FILTERS docMain(docd)==doc

    PROPERTIES = STRING[100](docid(doc))  EXTID 'ID' IN IW_SMINTERNALWAYBILLS      
    PROPERTIES = STRING[100](doctype(doc)) EXTID 'DOCTYPE' IN IW_SMINTERNALWAYBILLS
    PROPERTIES = ourselfclient(doc) EXTID 'OURSELFCLIENT' IN IW_SMINTERNALWAYBILLS

    OBJECTS docd3 = DocDetail EXTID 'SMSPECTAX' IN IW
    PROPERTIES = docid(docd3) EXTID 'DOCID'    
    PROPERTIES = doctype(docd3) EXTID 'DOCTYPE'      
    PROPERTIES = index(docd3) EXTID 'SPECITEM'
    PROPERTIES = 0 IF docd3 IS DocDetail  EXTID 'TAXID'        
    PROPERTIES = OVERRIDE valueTax(docd3), 0 EXTID 'TAXRATE'
    PROPERTIES = OVERRIDE sumTax(docd3), 0 EXTID 'TAXSUM'            
    FILTERS docMain(docd3)==doc   
             
    OBJECTS docd4 = DocDetail EXTID 'SMSPECBY' IN IW
    PROPERTIES = docid(docd4) EXTID 'DOCID'    
    PROPERTIES = doctype(docd4) EXTID 'DOCTYPE'      
    PROPERTIES = index(docd4) EXTID 'SPECITEM'
    PROPERTIES = extracharge(docd4) EXTID 'EXTRACHARGE'  
    PROPERTIES = priceManufacturer(docd4) EXTID 'MANUFACTURERSPRICE'     
    PROPERTIES = priceRetail(docd4) EXTID 'RETAILPRICE'       
    PROPERTIES = 0 IF docd4 IS DocDetail EXTID 'STATEREGULATION'                           
    FILTERS docMain(docd4)==doc    
           
    OBJECTS docd5 = DocDetail EXTID 'SLSPECPACKS' IN IW
    PROPERTIES = docid(docd5) EXTID 'DOCID'    
    PROPERTIES = doctype(docd5) EXTID 'DOCTYPE'      
    PROPERTIES = index(docd5) EXTID 'SPECITEM'
    PROPERTIES = -1 IF docd5 IS DocDetail EXTID 'PACKNUM'        
    PROPERTIES = 0 IF docd5 IS DocDetail EXTID 'NPACKS'       
    PROPERTIES = 0 IF docd5 IS DocDetail EXTID 'PACKSIZE'     
    PROPERTIES = exportTime(toDateTime(expiryDate(docd5))) EXTID 'VALIDDATE'                
    FILTERS docMain(docd5)==doc    
    
    OBJECTS docd6 = DocDetail EXTID 'SLSPECQMISMATCH' IN IW
    PROPERTIES = docid(docd6) EXTID 'DOCID'    
    PROPERTIES = doctype(docd6) EXTID 'DOCTYPE'      
    PROPERTIES = index(docd6) EXTID 'SPECITEM'
    PROPERTIES = blankquantity(docd6) EXTID 'QUANTBYDOC'                  
    FILTERS docMain(docd6)==doc        
        
    OBJECTS b = DocBase EXTID 'SMCOMMONBASES' IN IW 
    PROPERTIES = STRING[100](docid(doc)) IF b IS DocBase EXTID 'ID'  
    PROPERTIES = STRING[10](doctype(doc)) IF b IS DocBase EXTID 'DOCTYPE'     
    PROPERTIES = doctype(b) EXTID 'BASEDOCTYPE'                    
    PROPERTIES = docid(b) EXTID 'BASEID'    
    FILTERS basisDoc(doc, b)              
    
    OBJECTS p = DocProp EXTID 'SMDOCPROPS' IN IW 
    PROPERTIES = STRING[100](docid(doc)) IF p IS DocProp EXTID 'DOCID'  
    PROPERTIES = STRING[10](doctype(doc)) IF p IS DocProp EXTID 'DOCTYPE'     
    PROPERTIES = paramname(p) EXTID 'PARAMNAME'                    
    PROPERTIES = paramvalue(p) EXTID 'PARAMVALUE'    
    FILTERS docMain(p) = doc  AND paramvalue(p)             
     
; 

GROUP AC;
GROUP AC_SMDOCUMENTS EXTID 'SMDOCUMENTS': AC;
GROUP AC_SMSPEC EXTID 'SMSPEC': AC;
GROUP AC_SMACTS EXTID 'SMACTS' : AC;
GROUP AC_SMSPECACTS EXTID 'SMSPECACTS' : AC;
GROUP AC_SMCOMMONBASES EXTID 'SMCOMMONBASES': AC;

FORM exportAC FORMEXTID 'PACKAGE' 
    PROPERTIES ATTR = exportTime(currentDateTime())  EXTID 'name'

    OBJECTS doc = DocMain EXTID 'POSTOBJECT'
    PROPERTIES ATTR = 'normal' IF doc IS DocMain EXTID 'action'      
    PROPERTIES ATTR = opname(doc) EXTID 'description'  
    
    PROPERTIES = STRING[100](id(doc)) EXTID 'Id'
    PROPERTIES = doctype(doc) EXTID 'DOCTYPE' IN AC_SMDOCUMENTS
    PROPERTIES = STRING[100](docid(doc)) EXTID 'ID' IN AC_SMDOCUMENTS
    PROPERTIES = bornin(doc) EXTID 'BORNIN' IN AC_SMDOCUMENTS    
    PROPERTIES = exportTime(creatdate(doc))  EXTID 'CREATEDAT' IN AC_SMDOCUMENTS    
    PROPERTIES = docstate(doc) EXTID 'DOCSTATE' IN AC_SMDOCUMENTS           
    PROPERTIES = opcode(doc) EXTID 'OPCODE' IN AC_SMDOCUMENTS
    PROPERTIES = location(doc) EXTID 'LOCATION' IN AC_SMDOCUMENTS
    PROPERTIES = 1 IF doc IS DocMain EXTID 'CURRENCYTYPE' IN AC_SMDOCUMENTS        
    PROPERTIES = curRate(doc) EXTID 'CURRENCYRATE' IN AC_SMDOCUMENTS 
    PROPERTIES = 0 IF doc IS DocMain EXTID 'CURRENCYMULTORDER' IN AC_SMDOCUMENTS      
    PROPERTIES = OVERRIDE sumWithTax(doc), 0 EXTID 'TOTALSUM' IN AC_SMDOCUMENTS    
    PROPERTIES = OVERRIDE sumCurr(doc), 0 IF doc IS DocMain EXTID 'TOTALSUMCUR' IN AC_SMDOCUMENTS    
    PROPERTIES = OVERRIDE priceRoundMode(doc), 0 EXTID 'PRICEROUNDMODE' IN AC_SMDOCUMENTS       
    PROPERTIES = 1 IF doc IS DocMain  EXTID 'ISROUBLES' IN AC_SMDOCUMENTS      
    PROPERTIES = note(doc) EXTID 'COMMENTARY' IN AC_SMDOCUMENTS

    OBJECTS docd = DocDetail EXTID 'SMSPEC' IN AC 
    PROPERTIES = docid(docd) EXTID 'DOCID'    
    PROPERTIES = doctype(docMain(docd)) EXTID 'DOCTYPE'      
    PROPERTIES = index(docd) EXTID 'SPECITEM'
    PROPERTIES d1 = index(docd) EXTID 'DISPLAYITEM'
    PROPERTIES = skuId(docd) EXTID 'ARTICLE'                          
    PROPERTIES = OVERRIDE abs(quantity(docd)), 0 EXTID 'QUANTITY'
    PROPERTIES = OVERRIDE priceWithTax(docd), 0 EXTID 'ITEMPRICE'     
    PROPERTIES = OVERRIDE sumWithTax(docd), 0 EXTID 'TOTALPRICE'  
    PROPERTIES = OVERRIDE priceNoTax(docd), 0 EXTID 'ITEMPRICENOTAX'  
    PROPERTIES = OVERRIDE sumNoTax(docd), 0 EXTID 'TOTALPRICENOTAX'            
    PROPERTIES = OVERRIDE priceCurr(docd), 0 EXTID 'ITEMPRICECUR'                         
    PROPERTIES = OVERRIDE sumCurr(docd), 0 EXTID 'TOTALPRICECUR'      
    FILTERS docMain(docd)==doc
    
    PROPERTIES = 'AC' IF doc IS DocMain EXTID 'DOCTYPE' IN AC_SMACTS
    PROPERTIES = STRING[100](docid(doc))  EXTID 'ID' IN AC_SMACTS
    PROPERTIES = priceType(doc) EXTID 'PRICETYPE' IN AC_SMACTS
    PROPERTIES = exportTime(execDate(doc)) EXTID 'EXECDATE' IN AC_SMACTS     
    PROPERTIES = exportTime(execTime(doc)) EXTID 'EXECTIME' IN AC_SMACTS     
    PROPERTIES = 0 IF doc IS DocMain EXTID 'EXECIF' IN AC_SMACTS      
    PROPERTIES = reasonPricing(doc)EXTID 'REASON' IN AC_SMACTS      
    PROPERTIES = '0' IF doc IS DocMain EXTID 'LABELSPRINTED' IN AC_SMACTS      
    PROPERTIES = '0' IF doc IS DocMain EXTID 'CHARGEFULLPRICE' IN AC_SMACTS      
    PROPERTIES = 0 IF doc IS DocMain EXTID 'UTCOFFSET' IN AC_SMACTS      
    PROPERTIES = '0' IF doc IS DocMain EXTID 'SUMMERTIME' IN AC_SMACTS      
         
    FILTERS inc(doc)                                                           

    OBJECTS docd2 = DocDetail EXTID 'SMSPECACTS' IN AC 
    PROPERTIES = 'AC' IF docd2 IS DocDetail EXTID 'DOCTYPE'     
    PROPERTIES = docid(docd2) EXTID 'DOCID'   
    PROPERTIES = index(docd2) EXTID 'SPECITEM'    
    PROPERTIES = OVERRIDE oldPrice(docd2), 0 EXTID 'OLDPRICE'
    PROPERTIES = flags(docd2) EXTID 'FLAGS'
    PROPERTIES = revalSum(docd2) EXTID 'REVALSUM'
    PROPERTIES = revalOperQuantity(docd2) EXTID 'REVALOPERQUANTITY'
    FILTERS docMain(docd2)==doc
    
    OBJECTS docd3 = DocDetail EXTID 'SMSPECTAX' IN AC
    PROPERTIES = docid(docd3) EXTID 'DOCID'    
    PROPERTIES = 'AC' IF docd3 IS DocDetail EXTID 'DOCTYPE'      
    PROPERTIES = index(docd3) EXTID 'SPECITEM'    
    PROPERTIES = 0 IF docd3 IS DocDetail  EXTID 'TAXID'        
    PROPERTIES = OVERRIDE valueTax(docd3), 0 EXTID 'TAXRATE'
    PROPERTIES = OVERRIDE sumTax(docd3), 0 EXTID 'TAXSUM'            
    FILTERS docMain(docd3)==doc       
    
    OBJECTS b = DocBase EXTID 'SMCOMMONBASES' IN AC 
    PROPERTIES = STRING[100](docid(doc)) IF b IS DocBase EXTID 'ID'  
    PROPERTIES = STRING[10](doctype(doc)) IF b IS DocBase EXTID 'DOCTYPE'     
    PROPERTIES = doctype(b) EXTID 'BASEDOCTYPE'                    
    PROPERTIES = docid(b) EXTID 'BASEID'    
    FILTERS basisDoc(doc, b) 
    
    OBJECTS p = DocProp EXTID 'SMDOCPROPS' IN AC 
    PROPERTIES = STRING[100](docid(doc)) IF p IS DocProp EXTID 'DOCID'  
    PROPERTIES = STRING[10](doctype(doc)) IF p IS DocProp EXTID 'DOCTYPE'     
    PROPERTIES = paramname(p) EXTID 'PARAMNAME'                    
    PROPERTIES = paramvalue(p) EXTID 'PARAMVALUE'    
    FILTERS docMain(p) = doc AND paramvalue(p)                                                                         
;                                                

GROUP ORD EXTID 'OR';
GROUP OR_SMDOCUMENTS EXTID 'SMDOCUMENTS': ORD;
GROUP OR_SMDOCOR EXTID 'SMDOCOR': ORD;

FORM exportOR FORMEXTID 'PACKAGE'  
    PROPERTIES ATTR = exportTime(currentDateTime())  EXTID 'name'

    OBJECTS doc = DocMain EXTID 'POSTOBJECT'
    PROPERTIES ATTR = 'Заказ поставщику' IF doc IS DocMain EXTID 'description'  
    PROPERTIES ATTR = 'normal' IF doc IS DocMain EXTID 'action'  
    PROPERTIES = STRING[100](id(doc)) EXTID 'Id'
    PROPERTIES = STRING[100](docid(doc)) EXTID 'ID' IN OR_SMDOCUMENTS
    PROPERTIES = exportTime(creatdate(doc))  EXTID 'CREATEDAT' IN OR_SMDOCUMENTS    
    PROPERTIES = doctype(doc) EXTID 'DOCTYPE' IN OR_SMDOCUMENTS    
    PROPERTIES = bornin(doc) EXTID 'BORNIN' IN OR_SMDOCUMENTS       
    PROPERTIES = docstate(doc) EXTID 'DOCSTATE' IN OR_SMDOCUMENTS   
    PROPERTIES = -1 IF doc IS DocMain EXTID 'OPCODE' IN OR_SMDOCUMENTS
    PROPERTIES = clientIndex(doc) EXTID 'CLIENTINDEX' IN OR_SMDOCUMENTS        
    PROPERTIES = location(doc) EXTID 'LOCATION' IN OR_SMDOCUMENTS
    PROPERTIES = 1 IF doc IS DocMain EXTID 'CURRENCYTYPE' IN OR_SMDOCUMENTS        
    PROPERTIES = curRate(doc) EXTID 'CURRENCYRATE' IN OR_SMDOCUMENTS 
    PROPERTIES = 0 IF doc IS DocMain EXTID 'CURRENCYMULTORDER' IN OR_SMDOCUMENTS      
    PROPERTIES = OVERRIDE sumNoTax(doc), 0 EXTID 'TOTALSUM' IN OR_SMDOCUMENTS    
    PROPERTIES = OVERRIDE sumCurr(doc), 0 EXTID 'TOTALSUMCUR' IN OR_SMDOCUMENTS    
    PROPERTIES = OVERRIDE priceRoundMode(doc), 0 EXTID 'PRICEROUNDMODE' IN OR_SMDOCUMENTS       
    PROPERTIES = 1 IF doc IS DocMain EXTID 'ISROUBLES' IN OR_SMDOCUMENTS      
    PROPERTIES = note(doc)  EXTID 'COMMENTARY' IN OR_SMDOCUMENTS     
    FILTERS inc(doc)     
    
    PROPERTIES = STRING[100](docid(doc)) EXTID 'ID' IN OR_SMDOCOR      
    PROPERTIES = STRING[50](doctype(doc)) EXTID 'DOCTYPE' IN OR_SMDOCOR 
    PROPERTIES = ourselfclient(doc) EXTID 'OURSELFCLIENT' IN OR_SMDOCOR    
    PROPERTIES = exportTime(orderdate(doc)) EXTID 'ORDERDATE' IN OR_SMDOCOR    
    PROPERTIES = exportTime(supplydate(doc)) EXTID 'SUPPLYDATE' IN OR_SMDOCOR  
    PROPERTIES = 0 IF doc IS DocMain EXTID 'SUPPLYTIME' IN OR_SMDOCOR  
    PROPERTIES = 1439 IF doc IS DocMain EXTID 'SUPPLYTIMETILL' IN OR_SMDOCOR  
    PROPERTIES = '1' IF doc IS DocMain EXTID 'USEFORAUTOGEN' IN OR_SMDOCOR      

    OBJECTS docd = DocDetail EXTID 'SMSPECOR' IN ORD 
    PROPERTIES = docid(docd) EXTID 'DOCID'    
    PROPERTIES = doctype(docMain(docd)) EXTID 'DOCTYPE'      
    PROPERTIES = index(docd) EXTID 'SPECITEM'
    PROPERTIES d1 = index(docd) EXTID 'DISPLAYITEM'
    PROPERTIES = skuId(docd) EXTID 'ARTICLE'                          
    PROPERTIES = OVERRIDE abs(quantity(docd)), 0 EXTID 'QUANTITY'
    PROPERTIES = OVERRIDE priceNoTax(docd), 0 EXTID 'ITEMPRICE'     
    PROPERTIES = OVERRIDE sumNoTax(docd), 0 EXTID 'TOTALPRICE'  
    PROPERTIES = OVERRIDE priceCurr(docd), 0 EXTID 'ITEMPRICECUR'                         
    PROPERTIES = OVERRIDE sumCurr(docd), 0 EXTID 'TOTALPRICECUR'      
    PROPERTIES = 0 IF docd IS DocDetail EXTID 'SUGGESTQUANTITY'  
    FILTERS docMain(docd)=doc     
    
    OBJECTS b = DocBase EXTID 'SMCOMMONBASES' IN ORD 
    PROPERTIES = STRING[100](docid(doc)) IF b IS DocBase EXTID 'ID'  
    PROPERTIES = STRING[10](doctype(doc)) IF b IS DocBase EXTID 'DOCTYPE'     
    PROPERTIES = doctype(b) EXTID 'BASEDOCTYPE'                    
    PROPERTIES = docid(b) EXTID 'BASEID'    
    FILTERS basisDoc(doc, b) 
    
    OBJECTS p = DocProp EXTID 'SMDOCPROPS' IN ORD 
    PROPERTIES = STRING[100](docid(doc)) IF p IS DocProp EXTID 'DOCID'  
    PROPERTIES = STRING[10](doctype(doc)) IF p IS DocProp EXTID 'DOCTYPE'     
    PROPERTIES = paramname(p) EXTID 'PARAMNAME'                    
    PROPERTIES = paramvalue(p) EXTID 'PARAMVALUE'    
    FILTERS docMain(p) = doc AND paramvalue(p)                                                                         
;    

GROUP SO EXTID 'SO';
GROUP SO_SMDOCUMENTS EXTID 'SMDOCUMENTS': SO;
GROUP SO_SMSTOREORDERS EXTID 'SMSTOREORDERS': SO;

FORM exportSO FORMEXTID 'PACKAGE'  
    PROPERTIES ATTR = exportTime(currentDateTime())  EXTID 'name'

    OBJECTS doc = DocMain EXTID 'POSTOBJECT'
    PROPERTIES ATTR = 'Заказ поставщику' IF doc IS DocMain EXTID 'description'  
    PROPERTIES ATTR = 'normal' IF doc IS DocMain EXTID 'action'  
    PROPERTIES = STRING[100](id(doc)) EXTID 'Id'
    PROPERTIES = STRING[100](docid(doc)) EXTID 'ID' IN SO_SMDOCUMENTS
    PROPERTIES = exportTime(creatdate(doc))  EXTID 'CREATEDAT' IN SO_SMDOCUMENTS    
    PROPERTIES = doctype(doc) EXTID 'DOCTYPE' IN SO_SMDOCUMENTS    
    PROPERTIES = bornin(doc) EXTID 'BORNIN' IN SO_SMDOCUMENTS       
    PROPERTIES = docstate(doc) EXTID 'DOCSTATE' IN SO_SMDOCUMENTS   
    PROPERTIES = -1 IF doc IS DocMain EXTID 'OPCODE' IN SO_SMDOCUMENTS
    PROPERTIES = locationTo(doc) EXTID 'LOCATION' IN SO_SMDOCUMENTS
    PROPERTIES = 0 IF doc IS DocMain EXTID 'CURRENCYTYPE' IN SO_SMDOCUMENTS        
    PROPERTIES = 1 IF doc IS DocMain EXTID 'CURRENCYRATE' IN SO_SMDOCUMENTS 
    PROPERTIES = 0 IF doc IS DocMain EXTID 'CURRENCYMULTORDER' IN SO_SMDOCUMENTS      
    PROPERTIES = OVERRIDE sumWithTax(doc), 0 EXTID 'TOTALSUM' IN SO_SMDOCUMENTS    
    PROPERTIES = OVERRIDE sumCurr(doc), 0 EXTID 'TOTALSUMCUR' IN SO_SMDOCUMENTS    
    PROPERTIES = OVERRIDE priceRoundMode(doc), 0 EXTID 'PRICEROUNDMODE' IN SO_SMDOCUMENTS       
    PROPERTIES = 1 IF doc IS DocMain EXTID 'ISROUBLES' IN SO_SMDOCUMENTS      
    PROPERTIES = note(doc)  EXTID 'COMMENTARY' IN SO_SMDOCUMENTS     
    FILTERS inc(doc)     
    
    PROPERTIES = STRING[100](docid(doc)) EXTID 'ID' IN SO_SMSTOREORDERS      
    PROPERTIES = STRING[50](doctype(doc)) EXTID 'DOCTYPE' IN SO_SMSTOREORDERS 
    PROPERTIES = locationFrom(doc) EXTID 'LOCATION' IN SO_SMSTOREORDERS    
    PROPERTIES = exportTime(deliverydate(doc)) EXTID 'DELIVERYDATE' IN SO_SMSTOREORDERS  
    PROPERTIES = deliverytime(doc) EXTID 'DELIVETYTIME' IN SO_SMSTOREORDERS  

    OBJECTS docd = DocDetail EXTID 'SMSPEC' IN SO 
    PROPERTIES = docid(docd) EXTID 'DOCID'    
    PROPERTIES = doctype(docMain(docd)) EXTID 'DOCTYPE'      
    PROPERTIES = index(docd) EXTID 'SPECITEM'
    PROPERTIES d1 = index(docd) EXTID 'DISPLAYITEM'
    PROPERTIES = skuId(docd) EXTID 'ARTICLE'                          
    PROPERTIES = OVERRIDE abs(quantity(docd)), 0 EXTID 'QUANTITY'
    PROPERTIES = OVERRIDE priceNoTax(docd), 0 EXTID 'ITEMPRICE'     
    PROPERTIES = OVERRIDE sumNoTax(docd), 0 EXTID 'TOTALPRICE'  
    PROPERTIES = OVERRIDE priceCurr(docd), 0 EXTID 'ITEMPRICECUR'                         
    PROPERTIES = OVERRIDE sumCurr(docd), 0 EXTID 'TOTALPRICECUR'      
    PROPERTIES = 0 IF docd IS DocDetail EXTID 'SUGGESTQUANTITY'  
    FILTERS docMain(docd)=doc     
    
    OBJECTS b = DocBase EXTID 'SMCOMMONBASES' IN SO 
    PROPERTIES = STRING[100](docid(doc)) IF b IS DocBase EXTID 'ID'  
    PROPERTIES = STRING[10](doctype(doc)) IF b IS DocBase EXTID 'DOCTYPE'     
    PROPERTIES = doctype(b) EXTID 'BASEDOCTYPE'                    
    PROPERTIES = docid(b) EXTID 'BASEID'    
    FILTERS basisDoc(doc, b) 
    
    OBJECTS p = DocProp EXTID 'SMDOCPROPS' IN SO 
    PROPERTIES = STRING[100](docid(doc)) IF p IS DocProp EXTID 'DOCID'  
    PROPERTIES = STRING[10](doctype(doc)) IF p IS DocProp EXTID 'DOCTYPE'     
    PROPERTIES = paramname(p) EXTID 'PARAMNAME'                    
    PROPERTIES = paramvalue(p) EXTID 'PARAMVALUE'    
    FILTERS docMain(p) = doc AND paramvalue(p)                                                                         
;    


GROUP IL;
GROUP IL_SMDOCUMENTS EXTID 'SMDOCUMENTS': IL;
GROUP IL_SMINVLINST EXTID 'SMINVLINST': IL;

FORM exportIL FORMEXTID 'PACKAGE' 
    PROPERTIES ATTR = exportTime(currentDateTime())  EXTID 'name'

    OBJECTS doc = DocMain EXTID 'POSTOBJECT'
    PROPERTIES ATTR = 'normal' IF doc IS DocMain EXTID 'action'      
    PROPERTIES ATTR = 'Акт потерь' IF doc IS DocMain EXTID 'description'  
    PROPERTIES = STRING[100](id(doc)) EXTID 'Id'
    PROPERTIES = doctype(doc) EXTID 'DOCTYPE' IN IL_SMDOCUMENTS
    PROPERTIES = STRING[100](docid(doc)) EXTID 'ID' IN IL_SMDOCUMENTS
    PROPERTIES = bornin(doc) EXTID 'BORNIN' IN IL_SMDOCUMENTS    
    PROPERTIES = exportTime(creatdate(doc))  EXTID 'CREATEDAT' IN IL_SMDOCUMENTS    
    PROPERTIES = docstate(doc) EXTID 'DOCSTATE' IN IL_SMDOCUMENTS           
    PROPERTIES = -1 IF doc IS DocMain EXTID 'OPCODE' IN IL_SMDOCUMENTS
    PROPERTIES = location(doc) EXTID 'LOCATION' IN IL_SMDOCUMENTS
    PROPERTIES = 1 IF doc IS DocMain EXTID 'CURRENCYTYPE' IN IL_SMDOCUMENTS        
    PROPERTIES = curRate(doc) EXTID 'CURRENCYRATE' IN IL_SMDOCUMENTS 
    PROPERTIES = 0 IF doc IS DocMain EXTID 'CURRENCYMULTORDER' IN IL_SMDOCUMENTS      
    PROPERTIES = sumWithTax(doc) IF doc IS DocMain EXTID 'TOTALSUM' IN IL_SMDOCUMENTS    
    PROPERTIES = sumCurr(doc) IF doc IS DocMain EXTID 'TOTALSUMCUR' IN IL_SMDOCUMENTS    
    PROPERTIES = 0 IF doc IS DocMain EXTID 'PRICEROUNDMODE' IN IL_SMDOCUMENTS       
    PROPERTIES = 1 IF doc IS DocMain  EXTID 'ISROUBLES' IN IL_SMDOCUMENTS      
    PROPERTIES = note(doc) EXTID 'COMMENTARY' IN IL_SMDOCUMENTS     
    FILTERS inc(doc)                                              

    PROPERTIES = STRING[100](docid(doc)) EXTID 'ID' IN IL_SMINVLINST      
    PROPERTIES = STRING[50](doctype(doc)) EXTID 'DOCTYPE' IN IL_SMINVLINST 
    PROPERTIES = 0 IF doc IS DocMain EXTID 'FILLSPECTYPE' IN IL_SMINVLINST  
    PROPERTIES = '0' IF doc IS DocMain EXTID 'ISFILLCOMPLETE' IN IL_SMINVLINST  
    PROPERTIES = '0' IF doc IS DocMain EXTID 'ISACTIVEONLY' IN IL_SMINVLINST  
    PROPERTIES = priceType(doc) IF doc IS DocMain EXTID 'PRICETYPE' IN IL_SMINVLINST  
    PROPERTIES = orderno(doc) IF doc IS DocMain EXTID 'ORDERNO' IN IL_SMINVLINST  
    PROPERTIES = ourselfclient(doc) EXTID 'OURSELFCLIENT' IN IL_SMINVLINST    
    PROPERTIES = exportTime(startdate(doc)) EXTID 'PREAMBLEDATE' IN IL_SMINVLINST    
    PROPERTIES = exportTime(enddate(doc)) EXTID 'FINALDATE' IN IL_SMINVLINST  
    PROPERTIES loc = location(doc) EXTID 'STORELOC' IN IL_SMINVLINST  
//    PROPERTIES = 0 IF doc IS DocMain EXTID 'ZONEID' IN IL_SMINVLINST      
//    PROPERTIES = '' IF doc IS DocMain EXTID 'SPECTYPENAME' IN IL_SMINVLINST  
    PROPERTIES = 0 IF doc IS DocMain EXTID 'PRICEMODE' IN IL_SMINVLINST      
    PROPERTIES = '1' IF doc IS DocMain EXTID 'WITHDUE' IN IL_SMINVLINST      

    OBJECTS docd = DocDetail EXTID 'SMSPEC' IN IL 
    PROPERTIES = docid(docd) EXTID 'DOCID'    
    PROPERTIES = doctype(docMain(docd)) EXTID 'DOCTYPE'      
    PROPERTIES = index(docd) EXTID 'SPECITEM'
    PROPERTIES d1 = index(docd) EXTID 'DISPLAYITEM'
    PROPERTIES = skuId(docd) EXTID 'ARTICLE'                          
    PROPERTIES = OVERRIDE abs(quantity(docd)), 0 EXTID 'QUANTITY'
    PROPERTIES = priceWithTax(docd) IF docd IS DocDetail EXTID 'ITEMPRICE'     
    PROPERTIES = sumWithTax(docd) IF docd IS DocDetail EXTID 'TOTALPRICE'  
//    PROPERTIES = priceNoTax(docd) IF docd IS DocDetail EXTID 'ITEMPRICENOTAX'  
//    PROPERTIES = sumNoTax(docd) IF docd IS DocDetail EXTID 'TOTALPRICENOTAX'            
    PROPERTIES = priceCurr(docd) IF docd IS DocDetail EXTID 'ITEMPRICECUR'                         
    PROPERTIES = sumCurr(docd) IF docd IS DocDetail EXTID 'TOTALPRICECUR'      
    FILTERS docMain(docd)=doc
    
    OBJECTS docd2 = DocDetail EXTID 'SMSPECRL' IN IL 
    PROPERTIES = docid(docd2) EXTID 'DOCID'    
    PROPERTIES = doctype(docMain(docd2)) EXTID 'DOCTYPE'      
    PROPERTIES = index(docd2) EXTID 'SPECITEM'
    PROPERTIES = awaitquantity(docd2) EXTID 'AWAITQUANTITY'
    PROPERTIES = actualquantity(docd2) EXTID 'ACTUALQUANTITY'                          
    FILTERS docMain(docd2)=doc
    
    OBJECTS p = DocProp EXTID 'SMDOCPROPS' IN IL 
    PROPERTIES = STRING[100](docid(doc)) IF p IS DocProp EXTID 'DOCID'  
    PROPERTIES = STRING[10](doctype(doc)) IF p IS DocProp EXTID 'DOCTYPE'     
    PROPERTIES = paramname(p) EXTID 'PARAMNAME'                    
    PROPERTIES = paramvalue(p) EXTID 'PARAMVALUE'    
    FILTERS docMain(p) = doc AND paramvalue(p)                                                                         
;

GROUP RL;
GROUP RL_SMDOCUMENTS EXTID 'SMDOCUMENTS': RL;
GROUP RL_SMROLLS EXTID 'SMROLLS': RL;

FORM exportRL FORMEXTID 'PACKAGE' 
    PROPERTIES ATTR = exportTime(currentDateTime())  EXTID 'name'

    OBJECTS doc = DocMain EXTID 'POSTOBJECT'
    PROPERTIES ATTR = 'normal' IF doc IS DocMain EXTID 'action'      
    PROPERTIES ATTR = 'Сличительная ведомость' IF doc IS DocMain EXTID 'description'  
    PROPERTIES = STRING[100](id(doc)) EXTID 'Id'
    PROPERTIES = doctype(doc) EXTID 'DOCTYPE' IN RL_SMDOCUMENTS
    PROPERTIES = STRING[100](docid(doc)) EXTID 'ID' IN RL_SMDOCUMENTS
    PROPERTIES = bornin(doc) EXTID 'BORNIN' IN RL_SMDOCUMENTS    
    PROPERTIES = exportTime(creatdate(doc))  EXTID 'CREATEDAT' IN RL_SMDOCUMENTS    
    PROPERTIES = docstate(doc) EXTID 'DOCSTATE' IN RL_SMDOCUMENTS           
    PROPERTIES = -1 IF doc IS DocMain EXTID 'OPCODE' IN RL_SMDOCUMENTS
    PROPERTIES = location(doc) EXTID 'LOCATION' IN RL_SMDOCUMENTS
    PROPERTIES = 1 IF doc IS DocMain EXTID 'CURRENCYTYPE' IN RL_SMDOCUMENTS        
    PROPERTIES = curRate(doc) EXTID 'CURRENCYRATE' IN RL_SMDOCUMENTS 
    PROPERTIES = 0 IF doc IS DocMain EXTID 'CURRENCYMULTORDER' IN RL_SMDOCUMENTS      
    PROPERTIES = sumWithTax(doc) IF doc IS DocMain EXTID 'TOTALSUM' IN RL_SMDOCUMENTS    
    PROPERTIES = sumCurr(doc) IF doc IS DocMain EXTID 'TOTALSUMCUR' IN RL_SMDOCUMENTS    
    PROPERTIES = 0 IF doc IS DocMain EXTID 'PRICEROUNDMODE' IN RL_SMDOCUMENTS       
    PROPERTIES = 1 IF doc IS DocMain  EXTID 'ISROUBLES' IN RL_SMDOCUMENTS      
    PROPERTIES = note(doc) EXTID 'COMMENTARY' IN RL_SMDOCUMENTS     
    FILTERS inc(doc)                                              

    PROPERTIES = STRING[100](docid(doc)) EXTID 'ID' IN RL_SMROLLS      
    PROPERTIES = STRING[50](doctype(doc)) EXTID 'DOCTYPE' IN RL_SMROLLS 
    PROPERTIES = 1 IF doc IS DocMain EXTID 'ROLLMODE' IN RL_SMROLLS  
    PROPERTIES = 0 IF doc IS DocMain EXTID 'FILLSPECTYPE' IN RL_SMROLLS  
    PROPERTIES = '0' IF doc IS DocMain EXTID 'ISFILLCOMPLETE' IN RL_SMROLLS  
    PROPERTIES = '0' IF doc IS DocMain EXTID 'ISACTIVEONLY' IN RL_SMROLLS  
    PROPERTIES = priceType(doc) IF doc IS DocMain EXTID 'PRICETYPE' IN RL_SMROLLS  
    PROPERTIES = orderno(doc) IF doc IS DocMain EXTID 'ORDERNO' IN RL_SMROLLS  
    PROPERTIES = ourselfclient(doc) EXTID 'OURSELFCLIENT' IN RL_SMROLLS    
    PROPERTIES = exportTime(startdate(doc)) EXTID 'PREAMBLEDATE' IN RL_SMROLLS    
    PROPERTIES = exportTime(enddate(doc)) EXTID 'FINALDATE' IN RL_SMROLLS  
    PROPERTIES loc = location(doc) EXTID 'STORELOC' IN RL_SMROLLS  
//    PROPERTIES = 0 IF doc IS DocMain EXTID 'ZONEID' IN IL_SMINVLINST      
//    PROPERTIES = '' IF doc IS DocMain EXTID 'SPECTYPENAME' IN IL_SMINVLINST  
    PROPERTIES = 0 IF doc IS DocMain EXTID 'PRICEMODE' IN RL_SMROLLS      
    PROPERTIES = '1' IF doc IS DocMain EXTID 'WITHDUE' IN RL_SMROLLS      

    OBJECTS docd = DocDetail EXTID 'SMSPEC' IN RL 
    PROPERTIES = docid(docd) EXTID 'DOCID'    
    PROPERTIES = doctype(docMain(docd)) EXTID 'DOCTYPE'      
    PROPERTIES = index(docd) EXTID 'SPECITEM'
    PROPERTIES d1 = index(docd) EXTID 'DISPLAYITEM'
    PROPERTIES = skuId(docd) EXTID 'ARTICLE'                          
    PROPERTIES = OVERRIDE abs(quantity(docd)), 0 EXTID 'QUANTITY'
    PROPERTIES = priceWithTax(docd) IF docd IS DocDetail EXTID 'ITEMPRICE'     
    PROPERTIES = sumWithTax(doc) IF docd IS DocDetail EXTID 'TOTALPRICE'  
    PROPERTIES = priceNoTax(docd) IF docd IS DocDetail EXTID 'ITEMPRICENOTAX'  
    PROPERTIES = sumNoTax(docd) IF docd IS DocDetail EXTID 'TOTALPRICENOTAX'            
    PROPERTIES = priceCurr(docd) IF docd IS DocDetail EXTID 'ITEMPRICECUR'                         
    PROPERTIES = sumCurr(docd) IF docd IS DocDetail EXTID 'TOTALPRICECUR'      
    FILTERS docMain(docd)=doc
    
    OBJECTS docd2 = DocDetail EXTID 'SMSPECRL' IN RL 
    PROPERTIES = docid(docd2) EXTID 'DOCID'    
    PROPERTIES = doctype(docMain(docd2)) EXTID 'DOCTYPE'      
    PROPERTIES = index(docd2) EXTID 'SPECITEM'
    PROPERTIES = awaitquantity(docd2) EXTID 'AWAITQUANTITY'
    PROPERTIES = awaittotalprice(docd2) EXTID 'AWAITTOTALPRICE'                          
    PROPERTIES = awaittotalpricecur(docd2) EXTID 'AWAITTOTALPRICECUR'                          
    PROPERTIES = actualquantity(docd2) EXTID 'ACTUALQUANTITY'                          
    FILTERS docMain(docd2)=doc
    
    OBJECTS p = DocProp EXTID 'SMDOCPROPS' IN IL 
    PROPERTIES = STRING[100](docid(doc)) IF p IS DocProp EXTID 'DOCID'  
    PROPERTIES = STRING[10](doctype(doc)) IF p IS DocProp EXTID 'DOCTYPE'     
    PROPERTIES = paramname(p) EXTID 'PARAMNAME'                    
    PROPERTIES = paramvalue(p) EXTID 'PARAMVALUE'    
    FILTERS docMain(p) = doc AND paramvalue(p)                                                                         
;


GROUP LA;
GROUP LA_SMDOCUMENTS EXTID 'SMDOCUMENTS': LA;
GROUP LA_SMCOMMONBASES EXTID 'SMCOMMONBASES': LA;
GROUP LA_SMSPEC EXTID 'SMSPEC': LA;

FORM exportLA FORMEXTID 'PACKAGE' 
    PROPERTIES ATTR = exportTime(currentDateTime())  EXTID 'name'

    OBJECTS doc = DocMain EXTID 'POSTOBJECT'
    PROPERTIES ATTR = 'normal' IF doc IS DocMain EXTID 'action'      
    PROPERTIES ATTR = 'Акт потерь' IF doc IS DocMain EXTID 'description'  
    PROPERTIES = STRING[100](id(doc)) EXTID 'Id'
    PROPERTIES = doctype(doc) EXTID 'DOCTYPE' IN LA_SMDOCUMENTS
    PROPERTIES = STRING[100](docid(doc)) EXTID 'ID' IN LA_SMDOCUMENTS
    PROPERTIES = bornin(doc) EXTID 'BORNIN' IN LA_SMDOCUMENTS    
    PROPERTIES = exportTime(creatdate(doc))  EXTID 'CREATEDAT' IN LA_SMDOCUMENTS    
    PROPERTIES = docstate(doc) EXTID 'DOCSTATE' IN LA_SMDOCUMENTS           
    PROPERTIES = opcode(doc) EXTID 'OPCODE' IN LA_SMDOCUMENTS
    PROPERTIES = userop(doc) EXTID 'USEROP' IN LA_SMDOCUMENTS        
    PROPERTIES = location(doc) EXTID 'LOCATION' IN LA_SMDOCUMENTS
    PROPERTIES = 1 IF doc IS DocMain EXTID 'CURRENCYTYPE' IN LA_SMDOCUMENTS        
    PROPERTIES = curRate(doc) EXTID 'CURRENCYRATE' IN LA_SMDOCUMENTS 
    PROPERTIES = 0 IF doc IS DocMain EXTID 'CURRENCYMULTORDER' IN LA_SMDOCUMENTS      
    PROPERTIES = 0 IF doc IS DocMain EXTID 'TOTALSUM' IN LA_SMDOCUMENTS    
    PROPERTIES = 0 IF doc IS DocMain EXTID 'TOTALSUMCUR' IN LA_SMDOCUMENTS    
    PROPERTIES = 0 IF doc IS DocMain EXTID 'PRICEROUNDMODE' IN LA_SMDOCUMENTS       
    PROPERTIES = 1 IF doc IS DocMain  EXTID 'ISROUBLES' IN LA_SMDOCUMENTS      
    PROPERTIES = note(doc) EXTID 'COMMENTARY' IN LA_SMDOCUMENTS     
    FILTERS inc(doc)                                              

    OBJECTS docd = DocDetail EXTID 'SMSPEC' IN LA 
    PROPERTIES = docid(docd) EXTID 'DOCID'    
    PROPERTIES = doctype(docMain(docd)) EXTID 'DOCTYPE'      
    PROPERTIES = index(docd) EXTID 'SPECITEM'
    PROPERTIES d1 = index(docd) EXTID 'DISPLAYITEM'
    PROPERTIES = skuId(docd) EXTID 'ARTICLE'                          
    PROPERTIES = OVERRIDE abs(quantity(docd)), 0 EXTID 'QUANTITY'
    PROPERTIES = 0 IF docd IS DocDetail EXTID 'ITEMPRICE'     
    PROPERTIES = 0 IF docd IS DocDetail EXTID 'TOTALPRICE'  
    PROPERTIES = 0 IF docd IS DocDetail EXTID 'ITEMPRICENOTAX'  
    PROPERTIES = 0 IF docd IS DocDetail EXTID 'TOTALPRICENOTAX'            
    PROPERTIES = 0 IF docd IS DocDetail EXTID 'ITEMPRICECUR'                         
    PROPERTIES = 0 IF docd IS DocDetail EXTID 'TOTALPRICECUR'      
    FILTERS docMain(docd)=doc     
    
    OBJECTS b = DocBase EXTID 'SMCOMMONBASES' IN LA 
    PROPERTIES = STRING[100](docid(doc)) IF b IS DocBase EXTID 'ID'  
    PROPERTIES = STRING[10](doctype(doc)) IF b IS DocBase EXTID 'DOCTYPE'     
    PROPERTIES = doctype(b) EXTID 'BASEDOCTYPE'                    
    PROPERTIES = docid(b) EXTID 'BASEID'    
    FILTERS basisDoc(doc, b) 
    
    OBJECTS p = DocProp EXTID 'SMDOCPROPS' IN LA 
    PROPERTIES = STRING[100](docid(doc)) IF p IS DocProp EXTID 'DOCID'  
    PROPERTIES = STRING[10](doctype(doc)) IF p IS DocProp EXTID 'DOCTYPE'     
    PROPERTIES = paramname(p) EXTID 'PARAMNAME'                    
    PROPERTIES = paramvalue(p) EXTID 'PARAMVALUE'    
    FILTERS docMain(p) = doc AND paramvalue(p)                                                                         
;

GROUP FA;
GROUP FA_SMDOCUMENTS EXTID 'SMDOCUMENTS': FA;

FORM exportFA FORMEXTID 'PACKAGE' 
    PROPERTIES ATTR = exportTime(currentDateTime())  EXTID 'name'

    OBJECTS doc = DocMain EXTID 'POSTOBJECT'
    PROPERTIES ATTR = 'normal' IF doc IS DocMain EXTID 'action'      
    PROPERTIES ATTR = 'Акт потерь' IF doc IS DocMain EXTID 'description'  
    PROPERTIES = STRING[100](id(doc)) EXTID 'Id'
    PROPERTIES = doctype(doc) EXTID 'DOCTYPE' IN FA_SMDOCUMENTS
    PROPERTIES = STRING[100](docid(doc)) EXTID 'ID' IN FA_SMDOCUMENTS
    PROPERTIES = bornin(doc) EXTID 'BORNIN' IN FA_SMDOCUMENTS    
    PROPERTIES = exportTime(creatdate(doc))  EXTID 'CREATEDAT' IN FA_SMDOCUMENTS    
    PROPERTIES = docstate(doc) EXTID 'DOCSTATE' IN FA_SMDOCUMENTS           
    PROPERTIES = opcode(doc) EXTID 'OPCODE' IN FA_SMDOCUMENTS
    PROPERTIES = userop(doc) EXTID 'USEROP' IN FA_SMDOCUMENTS        
    PROPERTIES = location(doc) EXTID 'LOCATION' IN FA_SMDOCUMENTS
    PROPERTIES = 1 IF doc IS DocMain EXTID 'CURRENCYTYPE' IN FA_SMDOCUMENTS        
    PROPERTIES = curRate(doc) EXTID 'CURRENCYRATE' IN FA_SMDOCUMENTS 
    PROPERTIES = 0 IF doc IS DocMain EXTID 'CURRENCYMULTORDER' IN FA_SMDOCUMENTS      
    PROPERTIES = 0 IF doc IS DocMain EXTID 'TOTALSUM' IN FA_SMDOCUMENTS    
    PROPERTIES = 0 IF doc IS DocMain EXTID 'TOTALSUMCUR' IN FA_SMDOCUMENTS    
    PROPERTIES = 0 IF doc IS DocMain EXTID 'PRICEROUNDMODE' IN FA_SMDOCUMENTS       
    PROPERTIES = 1 IF doc IS DocMain  EXTID 'ISROUBLES' IN FA_SMDOCUMENTS      
    PROPERTIES = note(doc) EXTID 'COMMENTARY' IN FA_SMDOCUMENTS     
    FILTERS inc(doc)                                              

    OBJECTS docd = DocDetail EXTID 'SMSPEC' IN FA 
    PROPERTIES = docid(docd) EXTID 'DOCID'    
    PROPERTIES = doctype(docMain(docd)) EXTID 'DOCTYPE'      
    PROPERTIES = index(docd) EXTID 'SPECITEM'
    PROPERTIES d1 = index(docd) EXTID 'DISPLAYITEM'
    PROPERTIES = skuId(docd) EXTID 'ARTICLE'                          
    PROPERTIES = OVERRIDE abs(quantity(docd)), 0 EXTID 'QUANTITY'
    PROPERTIES = 0 IF docd IS DocDetail EXTID 'ITEMPRICE'     
    PROPERTIES = 0 IF docd IS DocDetail EXTID 'TOTALPRICE'  
    PROPERTIES = 0 IF docd IS DocDetail EXTID 'ITEMPRICENOTAX'  
    PROPERTIES = 0 IF docd IS DocDetail EXTID 'TOTALPRICENOTAX'            
    PROPERTIES = 0 IF docd IS DocDetail EXTID 'ITEMPRICECUR'                         
    PROPERTIES = 0 IF docd IS DocDetail EXTID 'TOTALPRICECUR'      
    FILTERS docMain(docd)=doc     
    
    OBJECTS b = DocBase EXTID 'SMCOMMONBASES' IN FA 
    PROPERTIES = STRING[100](docid(doc)) IF b IS DocBase EXTID 'ID'  
    PROPERTIES = STRING[10](doctype(doc)) IF b IS DocBase EXTID 'DOCTYPE'     
    PROPERTIES = doctype(b) EXTID 'BASEDOCTYPE'                    
    PROPERTIES = docid(b) EXTID 'BASEID'    
    FILTERS basisDoc(doc, b) 
    
    OBJECTS p = DocProp EXTID 'SMDOCPROPS' IN FA 
    PROPERTIES = STRING[100](docid(doc)) IF p IS DocProp EXTID 'DOCID'  
    PROPERTIES = STRING[10](doctype(doc)) IF p IS DocProp EXTID 'DOCTYPE'     
    PROPERTIES = paramname(p) EXTID 'PARAMNAME'                    
    PROPERTIES = paramvalue(p) EXTID 'PARAMVALUE'    
    FILTERS docMain(p) = doc AND paramvalue(p)                                                                          
;

GROUP CS;
GROUP CS_SMDOCUMENTS EXTID 'SMDOCUMENTS': CS;

FORM exportZReportSales FORMEXTID 'PACKAGE'
    PROPERTIES ATTR = exportTime(currentDateTime())  EXTID 'name'            

    OBJECTS doc = DocMain EXTID 'POSTOBJECT'
    PROPERTIES ATTR = 'normal' IF doc IS DocMain EXTID 'action'      
    PROPERTIES ATTR = 'Продажи по кассе' IF doc IS DocMain EXTID 'description'  
    
    PROPERTIES = STRING[100](id(doc)) EXTID 'Id'
    PROPERTIES = doctype(doc) EXTID 'DOCTYPE' IN CS_SMDOCUMENTS
    PROPERTIES = STRING[100](docid(doc)) EXTID 'ID' IN CS_SMDOCUMENTS
    PROPERTIES = bornin(doc) EXTID 'BORNIN' IN CS_SMDOCUMENTS    
    PROPERTIES = exportTime(creatdate(doc))  EXTID 'CREATEDAT' IN CS_SMDOCUMENTS    
    PROPERTIES = docstate(doc) EXTID 'DOCSTATE' IN CS_SMDOCUMENTS           
    PROPERTIES = opcode(doc) EXTID 'OPCODE' IN CS_SMDOCUMENTS
    PROPERTIES = userop(doc) EXTID 'USEROP' IN CS_SMDOCUMENTS        
    PROPERTIES = clientIndex(doc) EXTID 'CLIENTINDEX' IN CS_SMDOCUMENTS        
    PROPERTIES = locationFrom(doc) EXTID 'LOCATIONFROM' IN CS_SMDOCUMENTS   
    PROPERTIES = 1 IF doc IS DocMain EXTID 'CURRENCYTYPE' IN CS_SMDOCUMENTS        
    PROPERTIES = curRate(doc) EXTID 'CURRENCYRATE' IN CS_SMDOCUMENTS 
    PROPERTIES = 0 IF doc IS DocMain EXTID 'CURRENCYMULTORDER' IN CS_SMDOCUMENTS      
    PROPERTIES = OVERRIDE sumWithTax(doc), 0 EXTID 'TOTALSUM' IN CS_SMDOCUMENTS    
    PROPERTIES = OVERRIDE sumCurr(doc), 0 EXTID 'TOTALSUMCUR' IN CS_SMDOCUMENTS    
    PROPERTIES = OVERRIDE priceRoundMode(doc), 0 EXTID 'PRICEROUNDMODE' IN CS_SMDOCUMENTS       
    PROPERTIES = 1 IF doc IS DocMain  EXTID 'ISROUBLES' IN CS_SMDOCUMENTS      
    PROPERTIES = note(doc)  EXTID 'COMMENTARY' IN CS_SMDOCUMENTS     
    FILTERS inc(doc)                                                      

    OBJECTS p = DocPayment EXTID 'SMDOCCREDCARD' IN CS 
    PROPERTIES = STRING[100](docid(doc)) IF p IS DocPayment EXTID 'ID'  
    PROPERTIES = STRING[10](doctype(doc)) IF p IS DocPayment EXTID 'DOCTYPE'     
    PROPERTIES = credcardId(p) EXTID 'CREDCARDID'                    
    PROPERTIES = sum(p) EXTID 'TOTALSUM'    
    PROPERTIES = 0 IF p IS DocPayment  EXTID 'TOTALSUMCUR'
    FILTERS docMain(p) = doc AND sum(p)                                                                          

    OBJECTS docd = DocDetail EXTID 'SMSPEC' IN CS 
    PROPERTIES = docid(docd) EXTID 'DOCID'    
    PROPERTIES = doctype(docd) EXTID 'DOCTYPE'      
    PROPERTIES = indexPlus(docd) EXTID 'SPECITEM'
    PROPERTIES d1 = indexPlus(docd) EXTID 'DISPLAYITEM'
    PROPERTIES = skuId(docd) EXTID 'ARTICLE'                          
    PROPERTIES = OVERRIDE abs(quantity(docd)), 0 EXTID 'QUANTITY'
    PROPERTIES = OVERRIDE priceWithTax(docd), 0 EXTID 'ITEMPRICE'     
    PROPERTIES = OVERRIDE sumWithTax(docd), 0 EXTID 'TOTALPRICE'  
    PROPERTIES = OVERRIDE priceNoTax(docd), 0 EXTID 'ITEMPRICENOTAX'  
    PROPERTIES = OVERRIDE sumNoTax(docd), 0 EXTID 'TOTALPRICENOTAX'            
    PROPERTIES = OVERRIDE priceCurr(docd), 0 EXTID 'ITEMPRICECUR'                         
    PROPERTIES = OVERRIDE sumCurr(docd), 0 EXTID 'TOTALPRICECUR'      
    FILTERS docMain(docd)==doc AND moveType(docd) = 1
                           
    OBJECTS docd2 = DocDetail EXTID 'SMSPECCASHDISC' IN CS
    PROPERTIES = docid(docd2) EXTID 'DOCID'    
    PROPERTIES = doctype(docd2) EXTID 'DOCTYPE'      
    PROPERTIES = indexPlus(docd2) EXTID 'SPECITEM'    
    PROPERTIES = 2 IF docd2 IS DocDetail EXTID 'DISCKIND'        
    PROPERTIES = OVERRIDE discSum(docd2), 0 EXTID 'DISCSUM'
    PROPERTIES = OVERRIDE sumWithTax(docd2), 0 EXTID 'TOTALSUM'            
    FILTERS docMain(docd2)==doc AND moveType(docd2) = 1                                                                                  

    OBJECTS docd3 = DocDetail EXTID 'SMSPECTAX' IN CS
    PROPERTIES = docid(docd3) EXTID 'DOCID'    
    PROPERTIES = doctype(docd3) EXTID 'DOCTYPE'      
    PROPERTIES = indexPlus(docd3) EXTID 'SPECITEM'    
    PROPERTIES = 0 IF docd3 IS DocDetail  EXTID 'TAXID'        
    PROPERTIES = valueTax(docd3) EXTID 'TAXRATE'
    PROPERTIES = OVERRIDE sumTax(docd3),0 EXTID 'TAXSUM'            
    FILTERS docMain(docd3)==doc AND moveType(docd3) = 1                                                                                 
;
 
GROUP CR;
GROUP CR_SMDOCUMENTS EXTID 'SMDOCUMENTS': CR;

FORM exportZReportReturns FORMEXTID 'PACKAGE'  
    PROPERTIES ATTR = exportTime(currentDateTime())  EXTID 'name'

    OBJECTS doc = DocMain EXTID 'POSTOBJECT'
    PROPERTIES ATTR = 'normal' IF doc IS DocMain EXTID 'action'      
    PROPERTIES ATTR = 'Возвраты по кассе' IF doc IS DocMain EXTID 'description'  

    PROPERTIES = STRING[100](id(doc)) EXTID 'Id'
    PROPERTIES = doctype(doc) EXTID 'DOCTYPE' IN CR_SMDOCUMENTS
    PROPERTIES = STRING[100](docid(doc)) EXTID 'ID' IN CR_SMDOCUMENTS
    PROPERTIES = bornin(doc) EXTID 'BORNIN' IN CR_SMDOCUMENTS    
    PROPERTIES = exportTime(creatdate(doc))  EXTID 'CREATEDAT' IN CR_SMDOCUMENTS    
    PROPERTIES = docstate(doc) EXTID 'DOCSTATE' IN CR_SMDOCUMENTS           
    PROPERTIES = opcode(doc) EXTID 'OPCODE' IN CR_SMDOCUMENTS
    PROPERTIES = userop(doc) EXTID 'USEROP' IN CR_SMDOCUMENTS        
    PROPERTIES = clientIndex(doc) EXTID 'CLIENTINDEX' IN CR_SMDOCUMENTS        
    PROPERTIES = locationTo(doc) EXTID 'LOCATIONTO' IN CR_SMDOCUMENTS   
    PROPERTIES = 1 IF doc IS DocMain EXTID 'CURRENCYTYPE' IN CR_SMDOCUMENTS        
    PROPERTIES = curRate(doc) EXTID 'CURRENCYRATE' IN CR_SMDOCUMENTS 
    PROPERTIES = 0 IF doc IS DocMain EXTID 'CURRENCYMULTORDER' IN CR_SMDOCUMENTS      
    PROPERTIES = OVERRIDE abs(sumWithTax(doc)), 0 EXTID 'TOTALSUM' IN CR_SMDOCUMENTS    
    PROPERTIES = OVERRIDE abs(sumCurr(doc)), 0 EXTID 'TOTALSUMCUR' IN CR_SMDOCUMENTS    
    PROPERTIES = OVERRIDE priceRoundMode(doc), 0 EXTID 'PRICEROUNDMODE' IN CR_SMDOCUMENTS       
    PROPERTIES = 1 IF doc IS DocMain  EXTID 'ISROUBLES' IN CR_SMDOCUMENTS      
    PROPERTIES = note(doc)  EXTID 'COMMENTARY' IN CR_SMDOCUMENTS     
    FILTERS inc(doc)                                                      

    OBJECTS p = DocPayment EXTID 'SMDOCCREDCARD' IN CR 
    PROPERTIES = STRING[100](docid(doc)) IF p IS DocPayment EXTID 'ID'  
    PROPERTIES = STRING[10](doctype(doc)) IF p IS DocPayment EXTID 'DOCTYPE'     
    PROPERTIES = credcardId(p) EXTID 'CREDCARDID'                    
    PROPERTIES = sum(p) EXTID 'TOTALSUM'    
    PROPERTIES = 0 IF p IS DocPayment  EXTID 'TOTALSUMCUR'
    FILTERS docMain(p) = doc AND sum(p)                                                                          

    OBJECTS docd = DocDetail EXTID 'SMSPEC' IN CR 
    PROPERTIES = docid(docd) EXTID 'DOCID'    
    PROPERTIES = doctype(docd) EXTID 'DOCTYPE'      
    PROPERTIES = indexMinus(docd) EXTID 'SPECITEM'
    PROPERTIES d1 = indexMinus(docd) EXTID 'DISPLAYITEM'
    PROPERTIES = skuId(docd) EXTID 'ARTICLE'                          
    PROPERTIES = OVERRIDE abs(quantity(docd)), 0 EXTID 'QUANTITY'
    PROPERTIES = OVERRIDE abs(priceWithTax(docd)), 0 EXTID 'ITEMPRICE'     
    PROPERTIES = OVERRIDE abs(sumWithTax(docd)), 0 EXTID 'TOTALPRICE'  
    PROPERTIES = OVERRIDE abs(priceNoTax(docd)), 0 EXTID 'ITEMPRICENOTAX'  
    PROPERTIES = OVERRIDE abs(sumNoTax(docd)), 0 EXTID 'TOTALPRICENOTAX'            
    PROPERTIES = OVERRIDE abs(priceCurr(docd)), 0 EXTID 'ITEMPRICECUR'                         
    PROPERTIES = OVERRIDE abs(sumCurr(docd)), 0 EXTID 'TOTALPRICECUR'      
    PROPERTIES = causeType(docd) EXTID 'CAUSETYPE'            
    PROPERTIES = causeId(docd) EXTID 'CAUSEID'                         
    PROPERTIES = causeSpecItem(docd) EXTID 'CAUSESPECITEM'      
    FILTERS docMain(docd)==doc AND moveType(docd) = -1
                           
    OBJECTS docd3 = DocDetail EXTID 'SMSPECTAX' IN CR
    PROPERTIES = docid(docd3) EXTID 'DOCID'    
    PROPERTIES = doctype(docd3) EXTID 'DOCTYPE'      
    PROPERTIES = indexMinus(docd3) EXTID 'SPECITEM'    
    PROPERTIES = 0 IF docd3 IS DocDetail  EXTID 'TAXID'        
    PROPERTIES = valueTax(docd3) EXTID 'TAXRATE'
    PROPERTIES = OVERRIDE abs(sumTax(docd3)), 0 EXTID 'TAXSUM'            
    FILTERS docMain(docd3)==doc AND moveType(docd3) = -1                                                                                 
; 
