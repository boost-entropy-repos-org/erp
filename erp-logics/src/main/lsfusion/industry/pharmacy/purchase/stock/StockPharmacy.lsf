MODULE StockPharmacy;

REQUIRE SkuLedger, Pharmacy;

NAMESPACE Stock;

showSeriesPharmacy 'Показывать серию лекарственного средства' = DATA BOOLEAN ();
showContractPrice 'Показывать контрактную цену' = DATA BOOLEAN ();
showImportCountry 'Показывать страну ввоза' = DATA BOOLEAN ();

EXTEND FORM options
    PROPERTIES() showSeriesPharmacy, showContractPrice, showImportCountry
;

DESIGN options {
    pharmacy {   
        MOVE PROPERTY(showSeriesPharmacy());
        MOVE PROPERTY(showContractPrice());
        MOVE PROPERTY(showImportCountry());
    }
}                                                                                                           

seriesPharmacy 'Серия лекарственного средства' = ABSTRACT STRING[20] (Batch) MATERIALIZED;
prevSeriesPharmacy (Batch batch) = PREV(seriesPharmacy(batch));

contractPrice 'Контрактная цена' = ABSTRACT STRING[20] (Batch) MATERIALIZED;
prevContractPrice = PREV(contractPrice(Batch batch));

importCountry 'Страна ввоза' = ABSTRACT Country (Batch);
nameImportCountry 'Страна ввоза' = name(importCountry(Batch batch)) CHARWIDTH 15;

CONSTRAINT DROPPED(Country o IS Country) AND [ GROUP SUM 1 IF NOT importCountry(Batch b) BY PREV(importCountry(b))](o)
    MESSAGE 'Запрещено удалять атрибут (Страна), так как на него есть ссылки в партиях(страна ввоза)';

EXTEND FORM currentBalanceBatchStock
    PROPERTIES READONLY seriesPharmacy(bt) SHOWIF showSeriesPharmacy() AFTER nameSku(bt),
                        contractPrice(bt) SHOWIF showContractPrice() AFTER nameSku(bt),
                        nameImportCountry(bt) SHOWIF showImportCountry() AFTER nameSku(bt)
;

EXTEND FORM balanceBatchStock
    PROPERTIES READONLY seriesPharmacy(bt) SHOWIF showSeriesPharmacy() AFTER nameSku(bt),
                        contractPrice(bt) SHOWIF showContractPrice() AFTER nameSku(bt),
                        nameImportCountry(bt) SHOWIF showImportCountry() AFTER nameSku(bt)
;

EXTEND FORM dialogBatchStockOut
    PROPERTIES READONLY seriesPharmacy(bt) SHOWIF showSeriesPharmacy() AFTER nameSku(bt),
                        contractPrice(bt) SHOWIF showContractPrice() AFTER nameSku(bt),
                        nameImportCountry(bt) SHOWIF showImportCountry() AFTER nameSku(bt)
;

EXTEND FORM batches
    PROPERTIES READONLY seriesPharmacy(bt) SHOWIF showSeriesPharmacy() AFTER nameSku(bt),
                        contractPrice(bt) SHOWIF showContractPrice() AFTER nameSku(bt),
                        nameImportCountry(bt) SHOWIF showImportCountry() AFTER nameSku(bt)
;


